(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{6533:function(e,t,r){Promise.resolve().then(r.bind(r,6006))},6006:function(e,t,r){"use strict";r.r(t);var s=r(7821),n=r(8078),a=r(8504),o=r(3842),l=r(5231),i=r(9367),d=r(4362),c=r(5836),u=r(8006),m=r(641),h=r(4680),p=r(3295);let f=n.memo(()=>{let e=(0,a.useRouter)(),[t,r]=(0,n.useState)("phone"),[f,x]=(0,n.useState)(""),[g,v]=(0,n.useState)(""),[b,y]=(0,n.useState)(""),[j,N]=(0,n.useState)(""),[w,k]=(0,n.useState)(180),[A,C]=(0,n.useState)(!1),[S,P]=(0,n.useState)(!1),[R,z]=(0,n.useState)(null),[I,T]=(0,n.useState)(0);(0,n.useEffect)(()=>{if("otp"===t&&w>0){let e=setInterval(()=>{k(e=>e<=1?(C(!0),0):e-1)},1e3);return()=>clearInterval(e)}},[t,w]);let Z=async()=>{var e,t,s,n;if(!/^09\d{8}$/.test(f)){h.Am.error("請輸入正確的手機號碼格式");return}P(!0);try{let t=await p.iJ.verifyPhone(f);z(null!==(e=t.remaining)&&void 0!==e?e:null),r("otp"),k(180),C(!1),h.Am.success("驗證碼已發送")}catch(a){let e=(null===(s=a.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"發送驗證碼失敗";h.Am.error(e),(null===(n=a.response)||void 0===n?void 0:n.status)===401&&e.includes("已達上限")&&r("phone")}finally{P(!1)}},_=async()=>{var e,t,r;P(!0);try{let t=await p.iJ.verifyPhone(f);z(null!==(e=t.remaining)&&void 0!==e?e:null),k(180),C(!1),v(""),T(0),h.Am.success("驗證碼已重新發送"),F()}catch(e){h.Am.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"發送驗證碼失敗")}finally{P(!1)}},F=()=>{if("OTPCredential"in window){let e=new AbortController;return navigator.credentials.get({otp:{transport:["sms"]},signal:e.signal}).then(e=>{e&&e.code&&(v(e.code),setTimeout(()=>{e.code&&6===e.code.length&&E()},300))}).catch(e=>{"AbortError"!==e.name&&"NotSupportedError"!==e.name&&console.log("SMS OTP auto-fill failed:",e)}),setTimeout(()=>{e.abort()},3e5),e}return null};(0,n.useEffect)(()=>{let e=null;return"otp"===t&&f&&("https:"===window.location.protocol||"localhost"===window.location.hostname)&&(e=F()),()=>{e&&e.abort()}},[t,f]);let E=async()=>{if(6!==g.length){h.Am.error("請輸入完整的驗證碼");return}r("password")},L=async()=>{if(!b){h.Am.error("請輸入新密碼");return}if(!/^[a-zA-Z0-9]{6,12}$/.test(b)){h.Am.error("密碼長度應為6-12位，且只能包含英文字母和數字");return}if(b!==j){h.Am.error("兩次輸入的密碼不一致");return}P(!0);try{await p.iJ.resetPassword(f,g,b),T(0),h.Am.success("密碼重設成功！請使用新密碼重新登入",{duration:3e3}),setTimeout(()=>{e.push("/login")},1e3)}catch(a){var t,s;let e=(null===(s=a.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"重設密碼失敗";if(e.includes("連續5次輸入錯誤")){h.Am.error(e+"，請重新輸入手機號碼獲取驗證碼"),r("phone"),v(""),y(""),N(""),T(0);return}let n=e.match(/剩餘 (\d+) 次機會/);n&&T(5-parseInt(n[1],10)),v(""),h.Am.error(e)}finally{P(!1)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,s.jsx)("div",{className:"bg-card border-b border-border",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center justify-between relative",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/login"),className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,s.jsx)("h1",{className:"text-base text-foreground absolute left-1/2 -translate-x-1/2",children:"忘記密碼"}),(0,s.jsx)("div",{className:"w-[80px]"})]})}),(0,s.jsx)("div",{className:"max-w-md mx-auto p-6",children:(0,s.jsxs)(u.Zb,{className:"p-6 space-y-6 bg-card border-border shadow-none",children:["phone"===t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"輸入手機號碼"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"我們將發送驗證碼到您的手機"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(i._,{htmlFor:"phone",className:"text-sm text-foreground",children:"手機號碼"}),(0,s.jsx)(l.I,{id:"phone",type:"tel",placeholder:"0912345678",value:f,onChange:e=>x(e.target.value.replace(/\D/g,"").slice(0,10)),maxLength:10,className:"h-11 bg-input-background border-border",onKeyDown:e=>{"Enter"===e.key&&10===f.length&&Z()}}),(0,s.jsx)(o.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:Z,disabled:10!==f.length||S,children:S?"發送中...":"發送驗證碼"}),!1]})]}),"otp"===t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"輸入驗證碼"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["驗證碼已發送至 ",f]}),null!==R&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["今日剩餘發送次數：",R," 次"]}),I>0&&(0,s.jsxs)("p",{className:"text-xs text-destructive",children:["驗證碼錯誤 ",I," 次，剩餘 ",5-I," 次機會"]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(c.Zn,{maxLength:6,value:g,onChange:v,onComplete:E,children:(0,s.jsx)(c.hf,{children:Array.from({length:6}).map((e,t)=>(0,s.jsx)(c.cY,{index:t},t))})})}),(0,s.jsx)("div",{className:"text-center space-y-2",children:w>0?(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["重新發送 (","".concat(Math.floor(w/60),":").concat((w%60).toString().padStart(2,"0")),")"]}):(0,s.jsx)("button",{onClick:_,disabled:S,className:"text-sm text-primary hover:underline",children:"重新發送驗證碼"})}),(0,s.jsx)(o.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:E,disabled:6!==g.length||S,children:S?"驗證中...":"確認"}),(0,s.jsx)("button",{onClick:()=>{r("phone"),v(""),k(180),C(!1)},className:"w-full text-sm text-muted-foreground hover:text-foreground",children:"更改手機號碼"})]})]}),"password"===t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"設定新密碼"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"請輸入6-12位英數密碼"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(i._,{htmlFor:"password",className:"text-sm text-foreground",children:["新密碼",b&&(b.length<6||!/^[a-zA-Z0-9]+$/.test(b))&&(0,s.jsx)("span",{className:"ml-2 text-xs text-destructive",children:b.length<6?"（至少6位）":"（只能使用英數）"})]}),(0,s.jsx)(d.W,{id:"password",placeholder:"請輸入新密碼",value:b,onChange:e=>{let t=e.target.value;t.length<=12&&y(t)},className:"h-11 bg-input-background ".concat(b&&(b.length<6||!/^[a-zA-Z0-9]+$/.test(b))?"border-destructive":"border-border"),autoHideDelay:2e3,maxLength:12}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"6-12位英數，可大小寫，不可使用符號"}),b&&b.length<6&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:"密碼長度至少需要6位"}),b&&b.length>=6&&!/^[a-zA-Z0-9]+$/.test(b)&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:"密碼只能包含英文字母和數字，不可使用符號"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(i._,{htmlFor:"confirmPassword",className:"text-sm text-foreground",children:["確認密碼",j&&b&&j!==b&&(0,s.jsx)("span",{className:"ml-2 text-xs text-destructive",children:"（密碼不一致）"})]}),(0,s.jsx)(d.W,{id:"confirmPassword",placeholder:"請再次輸入密碼",value:j,onChange:e=>N(e.target.value),className:"h-11 bg-input-background ".concat(j&&b&&j!==b?"border-destructive":"border-border"),autoHideDelay:2e3,onKeyDown:e=>{"Enter"===e.key&&b&&j&&L()}}),j&&b&&j!==b&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:"密碼不一致，請重新輸入"})]}),(0,s.jsx)(o.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:L,disabled:!b||!j||b!==j||S,children:S?"重設中...":"重設密碼"})]})]})]})})]})});f.displayName="ForgotPasswordPage",t.default=f},3842:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var s=r(7821),n=r(8078),a=r(7035),o=r(898),l=r(7211);let i=(0,o.j)('inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*="size-"])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary-dark",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border bg-background text-foreground hover:bg-muted",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-md px-6",icon:"size-11 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:d=!1,...c}=e,u=d?a.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(i({variant:n,size:o,className:r})),ref:t,...c})});d.displayName="Button"},8006:function(e,t,r){"use strict";r.d(t,{Zb:function(){return o}});var s=r(7821),n=r(8078),a=r(7211);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("bg-card text-card-foreground rounded-2xl border shadow-sm",r),...n})});o.displayName="Card",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...n})}).displayName="CardHeader",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("h3",{ref:t,className:(0,a.cn)("text-xl font-semibold leading-none tracking-tight",r),...n})}).displayName="CardTitle",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...n})}).displayName="CardDescription",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...n})}).displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},5836:function(e,t,r){"use strict";r.d(t,{Zn:function(){return l},cY:function(){return d},hf:function(){return i}});var s=r(7821),n=r(8078),a=r(4422),o=r(7211);let l=n.forwardRef((e,t)=>{let{className:r,containerClassName:n,...l}=e;return(0,s.jsx)(a.uZ,{ref:t,containerClassName:(0,o.cn)("flex items-center gap-2",n),className:(0,o.cn)("disabled:cursor-not-allowed",r),...l})});l.displayName="InputOTP";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center",r),...n})});i.displayName="InputOTPGroup";let d=n.forwardRef((e,t)=>{let{index:r,className:l,...i}=e,{char:d,hasFakeCaret:c,isActive:u}=n.useContext(a.VM).slots[r];return(0,s.jsxs)("div",{ref:t,className:(0,o.cn)("relative flex h-11 w-11 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",u&&"z-10 ring-2 ring-ring ring-offset-background",l),...i,children:[d,c&&(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("div",{className:"h-4 w-px animate-caret-blink bg-foreground duration-1000"})})]})});d.displayName="InputOTPSlot"},5231:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var s=r(7821),n=r(8078),a=r(7211);let o=n.forwardRef((e,t)=>{let{className:r,type:n,...o}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-11 w-full rounded-lg border border-input bg-input px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},9367:function(e,t,r){"use strict";r.d(t,{_:function(){return l}});var s=r(7821),n=r(8078),a=r(255),o=r(7211);let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.f,{ref:t,className:(0,o.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",r),...n})});l.displayName=a.f.displayName},4362:function(e,t,r){"use strict";r.d(t,{W:function(){return d}});var s=r(7821),n=r(8078),a=r(534),o=r(2348),l=r(7211),i=r(5231);let d=n.forwardRef((e,t)=>{let{className:r,showToggle:d=!0,autoHideDelay:c=2e3,...u}=e,[m,h]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!1),x=(0,n.useRef)(null);return(0,n.useEffect)(()=>(c>0&&!p&&m&&(x.current=setTimeout(()=>{h(!1)},c)),()=>{x.current&&clearTimeout(x.current)}),[p,m,c]),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(i.I,{...u,ref:t,type:m?"text":"password",className:(0,l.cn)("pr-10",r),onFocus:e=>{f(!0),x.current&&clearTimeout(x.current),u.onFocus&&u.onFocus(e)},onBlur:e=>{f(!1),u.onBlur&&u.onBlur(e)}}),d&&(0,s.jsx)("button",{type:"button",onClick:()=>{h(!m),x.current&&clearTimeout(x.current)},className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",tabIndex:-1,children:m?(0,s.jsx)(a.Z,{className:"h-4 w-4",strokeWidth:1.5}):(0,s.jsx)(o.Z,{className:"h-4 w-4",strokeWidth:1.5})})]})});d.displayName="PasswordInput"},3295:function(e,t,r){"use strict";r.d(t,{no:function(){return i},iJ:function(){return n},S9:function(){return d},Mp:function(){return o},Wp:function(){return l},g8:function(){return a}});let s=r(9190).Z.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),s.interceptors.response.use(e=>e,e=>{var t,r,s,n,a,o,l,i,d,c,u,m,h;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(null===(s=e.config)||void 0===s?void 0:null===(r=s.url)||void 0===r?void 0:r.includes("/auth/verify-phone"))===!1&&(null===(a=e.config)||void 0===a?void 0:null===(n=a.url)||void 0===n?void 0:n.includes("/auth/check-phone"))===!1&&(null===(l=e.config)||void 0===l?void 0:null===(o=l.url)||void 0===o?void 0:o.includes("/auth/reset-verify-count"))===!1&&(null===(d=e.config)||void 0===d?void 0:null===(i=d.url)||void 0===i?void 0:i.includes("/auth/login"))===!1&&(null===(u=e.config)||void 0===u?void 0:null===(c=u.url)||void 0===c?void 0:c.includes("/auth/set-password"))===!1&&(null===(h=e.config)||void 0===h?void 0:null===(m=h.url)||void 0===m?void 0:m.includes("/auth/reset-password"))===!1&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let n={checkPhone:e=>s.get("/auth/check-phone/".concat(e)).then(e=>e.data),verifyPhone:e=>s.post("/auth/verify-phone",{phone:e}).then(e=>e.data),login:(e,t)=>s.post("/auth/login",{phone:e,code:t}).then(e=>e.data),passwordLogin:(e,t)=>s.post("/auth/password-login",{phone:e,password:t}).then(e=>e.data),setPassword:(e,t,r)=>s.post("/auth/set-password",{phone:e,code:t,password:r}).then(e=>e.data),resetPassword:(e,t,r)=>s.post("/auth/reset-password",{phone:e,code:t,newPassword:r}).then(e=>e.data),resetVerifyCount:e=>s.post("/auth/reset-verify-count",{phone:e}).then(e=>e.data)},a={getMe:()=>s.get("/users/me").then(e=>e.data),updateMe:e=>s.put("/users/me",e).then(e=>e.data),completeOnboarding:e=>s.put("/users/me/onboarding",e).then(e=>e.data),findByLicensePlate:e=>s.get("/users/license-plate/".concat(e)).then(e=>e.data),blockUser:e=>s.post("/users/block",{userId:e}).then(e=>e.data),unblockUser:e=>s.delete("/users/block/".concat(e)).then(e=>e.data),rejectUser:e=>s.post("/users/reject",{userId:e}).then(e=>e.data),unrejectUser:e=>s.delete("/users/reject/".concat(e)).then(e=>e.data),getBlockedList:()=>s.get("/users/blocked").then(e=>e.data),getRejectedList:()=>s.get("/users/rejected").then(e=>e.data)},o={create:e=>s.post("/messages",e).then(e=>e.data),getAll:e=>s.get("/messages",{params:{unreadOnly:e}}).then(e=>e.data),getSent:()=>s.get("/messages/sent").then(e=>e.data),getOne:e=>s.get("/messages/".concat(e)).then(e=>e.data),markAsRead:e=>s.post("/messages/".concat(e,"/read")).then(e=>e.data),reply:(e,t)=>s.post("/messages/".concat(e,"/reply"),{replyText:t}).then(e=>e.data),report:(e,t)=>s.post("/messages/".concat(e,"/report"),{reason:t}).then(e=>e.data)},l={getBalance:()=>s.get("/points/balance").then(e=>e.data),getHistory:()=>s.get("/points/history").then(e=>e.data),recharge:e=>s.post("/points/recharge",{amount:e}).then(e=>e.data)},i={checkLimit:()=>s.get("/ai/rewrite/limit").then(e=>e.data),rewrite:e=>s.post("/ai/rewrite",{text:e}).then(e=>e.data)},d={checkAvailability:e=>s.get("/users/check-license-plate/".concat(e)).then(e=>e.data),createApplication:e=>s.post("/users/license-plate-application",e).then(e=>e.data),getMyApplications:()=>s.get("/users/license-plate-application").then(e=>e.data),getApplication:e=>s.get("/users/license-plate-application/".concat(e)).then(e=>e.data)}},7211:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(2605),n=r(1638);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}}},function(e){e.O(0,[163,900,175,115,253,744],function(){return e(e.s=6533)}),_N_E=e.O()}]);