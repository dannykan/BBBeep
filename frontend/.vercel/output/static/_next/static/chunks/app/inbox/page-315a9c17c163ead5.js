(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{8471:function(e,t,a){Promise.resolve().then(a.bind(a,9462))},9462:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return z}});var s=a(7821),r=a(8078),n=a(8504),o=a(3923),l=a(3842),d=a(8006),i=a(641),c=a(3596),u=a(2625),m=a(9151),x=a(8149),p=a(2819),f=a(7211);let h=m.fC,g=m.xz;m.ZA,m.Uv,m.Tr,m.Ee,r.forwardRef((e,t)=>{let{className:a,inset:r,children:n,...o}=e;return(0,s.jsxs)(m.fF,{ref:t,className:(0,f.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",a),...o,children:[n,(0,s.jsx)(u.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=m.fF.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(m.tu,{ref:t,className:(0,f.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=m.tu.displayName;let v=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(m.Uv,{children:(0,s.jsx)(m.VY,{ref:t,sideOffset:r,className:(0,f.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});v.displayName=m.VY.displayName;let b=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(m.ck,{ref:t,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",a),...n})});b.displayName=m.ck.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...o}=e;return(0,s.jsxs)(m.oC,{ref:t,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(m.wU,{children:(0,s.jsx)(x.Z,{className:"h-4 w-4"})})}),r]})}).displayName=m.oC.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(m.Rk,{ref:t,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(m.wU,{children:(0,s.jsx)(p.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=m.Rk.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(m.__,{ref:t,className:(0,f.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})}).displayName=m.__.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(m.Z0,{ref:t,className:(0,f.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=m.Z0.displayName;var y=a(4680),N=a(1475),j=a(7830),w=a(3295),k=a(3759),C=a(3507);let S=r.memo(()=>{let e=(0,n.useRouter)(),{user:t,messages:a,refreshMessages:m,refreshUser:x}=(0,o.q)(),[p,f]=(0,r.useState)(null),[S,z]=(0,r.useState)(!1),[R,Z]=(0,r.useState)(!1),[A,I]=(0,r.useState)(""),[_,T]=(0,r.useState)(!1),[O,M]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!t){e.push("/login");return}m()},[t,e,m]);let P=a.find(e=>e.id===p),V=e=>{try{return(0,j.Q)(new Date(e),{addSuffix:!0})}catch(e){return"未知時間"}},W=async e=>{f(e);try{await w.Mp.getOne(e),await m()}catch(e){console.error("Failed to load message:",e)}},U=async()=>{var e,t,a;if(!(null==P?void 0:null===(e=P.sender)||void 0===e?void 0:e.id)){y.Am.error("無法識別發送者");return}try{await w.g8.blockUser(P.sender.id),y.Am.success("已封鎖該用戶"),f(null),z(!1),await x(),await m()}catch(e){y.Am.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"封鎖失敗")}},B=async()=>{if(!p){y.Am.error("無法識別訊息");return}M(!0);try{await w.Mp.report(p,A.trim()||void 0),y.Am.success("檢舉已提交，我們會儘快處理"),f(null),Z(!1),I(""),await m()}catch(a){var e,t;y.Am.error((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"檢舉失敗")}finally{M(!1)}},F=async e=>{if(p){T(!0);try{await w.Mp.reply(p,e),y.Am.success("回覆已儲存"),await m(),f(null)}catch(e){var t,a;y.Am.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"回覆失敗")}finally{T(!1)}}},E=e=>{switch(e){case"車況提醒":return"border-l-[3px] border-l-accent-vehicle";case"行車安全提醒":return"border-l-[3px] border-l-accent-safety";case"讚美感謝":return"border-l-[3px] border-l-accent-praise";default:return""}},J=e=>{switch(e){case"車況提醒":return"bg-accent-vehicle/10 text-accent-vehicle";case"行車安全提醒":return"bg-accent-safety/10 text-accent-safety";case"讚美感謝":return"bg-accent-praise/10 text-accent-praise";default:return"bg-muted text-muted-foreground"}};if(!t)return null;if("pedestrian"===t.userType)return(0,s.jsxs)("div",{className:"min-h-screen bg-background pb-20",children:[(0,s.jsx)("div",{className:"bg-card border-b border-border",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center justify-between relative",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/home"),className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,s.jsx)(i.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,s.jsx)("h1",{className:"text-base text-foreground absolute left-1/2 -translate-x-1/2",children:"收件箱"}),(0,s.jsx)("div",{className:"w-[80px]"})]})}),(0,s.jsx)("div",{className:"max-w-md mx-auto p-6",children:(0,s.jsxs)(d.Zb,{className:"p-8 text-center space-y-4",children:[(0,s.jsx)("p",{className:"text-foreground",children:"行人用戶無法接收提醒"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"因為沒有車牌號碼，其他人無法向您發送提醒"})]})}),(0,s.jsx)(N.Z,{})]});if(p&&P){var L;return(0,s.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,s.jsx)("div",{className:"bg-card border-b border-border",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center justify-between relative",children:[(0,s.jsxs)("button",{onClick:()=>f(null),className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,s.jsx)(i.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,s.jsx)("h1",{className:"text-base text-foreground absolute left-1/2 -translate-x-1/2",children:"提醒詳情"}),(0,s.jsx)("div",{className:"w-[80px]"}),P.sender&&(0,s.jsxs)(h,{children:[(0,s.jsx)(g,{asChild:!0,children:(0,s.jsx)("button",{className:"ml-auto p-1 hover:bg-muted/50 rounded transition-colors",children:(0,s.jsx)(c.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2})})}),(0,s.jsxs)(v,{align:"end",className:"w-40",children:[(0,s.jsx)(b,{onClick:()=>{z(!0)},className:"text-sm cursor-pointer",children:"封鎖此用戶"}),(0,s.jsx)(b,{onClick:()=>{Z(!0)},className:"text-sm text-destructive cursor-pointer focus:text-destructive",children:"檢舉訊息內容"})]})]})]})}),(0,s.jsxs)("div",{className:"max-w-md mx-auto p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"inline-block px-2.5 py-1 rounded-md text-xs ".concat(J(P.type)),children:P.type}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground tabular-nums",children:V(P.createdAt)})]}),(0,s.jsxs)(d.Zb,{className:"p-5 space-y-4 bg-card border-border shadow-none",children:[(0,s.jsx)("div",{className:"p-4 bg-muted/30 rounded-lg",children:(0,s.jsx)("p",{className:"text-base text-foreground leading-relaxed",children:P.template})}),P.customText&&(0,s.jsxs)("div",{className:"p-4 bg-primary/5 rounded-lg border border-primary/20",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"補充說明"}),(0,s.jsx)("p",{className:"text-base text-foreground leading-relaxed",children:P.customText})]}),P.sender&&(0,s.jsxs)("div",{className:"pt-4 border-t border-border",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"發送者"}),(0,s.jsx)("p",{className:"text-sm text-foreground mt-1",children:P.sender.nickname||"匿名"})]})]}),P.replyText&&(0,s.jsxs)(d.Zb,{className:"p-4 bg-primary/5 border-primary/20 shadow-none",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"您的回覆"}),(0,s.jsx)("p",{className:"text-sm text-foreground leading-relaxed",children:P.replyText})]}),"讚美感謝"===P.type&&!P.replyText&&(0,s.jsx)("div",{className:"px-4 py-3 bg-primary/5 rounded-lg border border-primary/20",children:(0,s.jsx)("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"收到讚美後回應「收到」可獲得 1 點回饋"})}),!P.replyText&&(0,s.jsx)("div",{className:"space-y-3",children:"讚美感謝"===P.type?(0,s.jsx)(l.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:()=>F("收到，謝謝！"),disabled:_,children:_?"處理中...":"收到，謝謝！"}):(0,s.jsx)(l.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:()=>F("收到，感謝提醒！"),disabled:_,children:_?"處理中...":"收到，感謝提醒！"})}),P.replyText&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)(l.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:()=>f(null),children:"確定"})})]}),(0,s.jsx)(k.Vq,{open:S,onOpenChange:z,children:(0,s.jsxs)(k.cZ,{children:[(0,s.jsxs)(k.fK,{children:[(0,s.jsx)(k.$N,{children:"封鎖用戶"}),(0,s.jsxs)(k.Be,{children:["確定要封鎖「",(null==P?void 0:null===(L=P.sender)||void 0===L?void 0:L.nickname)||"匿名","」嗎？封鎖後您將無法發送也無法接收該用戶的提醒。"]})]}),(0,s.jsxs)(k.cN,{children:[(0,s.jsx)(l.z,{variant:"outline",onClick:()=>z(!1),children:"取消"}),(0,s.jsx)(l.z,{variant:"destructive",onClick:U,children:"確認封鎖"})]})]})}),(0,s.jsx)(k.Vq,{open:R,onOpenChange:Z,children:(0,s.jsxs)(k.cZ,{children:[(0,s.jsxs)(k.fK,{children:[(0,s.jsx)(k.$N,{children:"檢舉訊息內容"}),(0,s.jsx)(k.Be,{children:"檢舉此訊息將提交給管理員審核。請說明檢舉原因（選填）。"})]}),(0,s.jsx)("div",{className:"py-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm text-foreground",children:"檢舉原因（選填）"}),(0,s.jsx)(C.g,{placeholder:"請說明檢舉原因...",value:A,onChange:e=>I(e.target.value),className:"min-h-[100px] resize-none",maxLength:200}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground text-right",children:[A.length,"/200"]})]})}),(0,s.jsxs)(k.cN,{children:[(0,s.jsx)(l.z,{variant:"outline",onClick:()=>{Z(!1),I("")},children:"取消"}),(0,s.jsx)(l.z,{variant:"destructive",onClick:B,disabled:O,children:O?"提交中...":"確認檢舉"})]})]})})]})}let q=a.filter(e=>!e.read);return(0,s.jsxs)("div",{className:"min-h-screen bg-background pb-20",children:[(0,s.jsx)("div",{className:"bg-card border-b border-border",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center justify-between relative",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/home"),className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,s.jsx)(i.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,s.jsx)("h1",{className:"text-base text-foreground absolute left-1/2 -translate-x-1/2",children:"收件箱"}),q.length>0?(0,s.jsx)("div",{className:"min-w-[20px] h-5 px-1.5 bg-primary rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-xs text-primary-foreground font-medium tabular-nums",children:q.length>99?"99+":q.length})}):(0,s.jsx)("div",{className:"w-[80px]"})]})}),(0,s.jsx)("div",{className:"max-w-md mx-auto p-6 space-y-4",children:0===a.length?(0,s.jsxs)(d.Zb,{className:"p-8 text-center space-y-4",children:[(0,s.jsx)("p",{className:"text-foreground",children:"尚無訊息"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"當您收到提醒時，會顯示在這裡"})]}):(0,s.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,s.jsx)("button",{onClick:()=>W(e.id),className:"w-full p-4 text-left hover:bg-muted/30 transition-colors bg-card border border-border rounded-lg ".concat(E(e.type)),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,s.jsx)("span",{className:"text-xs px-2 py-0.5 rounded font-medium ".concat(J(e.type)),children:e.type}),!e.read&&(0,s.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground tabular-nums ml-auto",children:V(e.createdAt)})]}),(0,s.jsx)("p",{className:"text-base text-foreground line-clamp-1 mb-1 font-medium",children:e.template}),e.customText&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:e.customText})]}),(0,s.jsx)(u.Z,{className:"h-4 w-4 text-muted-foreground flex-shrink-0 mt-1",strokeWidth:1.5})]})},e.id))})}),(0,s.jsx)(N.Z,{})]})});S.displayName="InboxPage";var z=S},1475:function(e,t,a){"use strict";var s=a(7821),r=a(8078),n=a(8504),o=a(3433),l=a(7737),d=a(3390),i=a(9775),c=a(7211);let u=r.memo(()=>{let e=(0,n.useRouter)(),t=(0,n.usePathname)(),a=[{path:"/home",icon:o.Z,label:"首頁"},{path:"/send",icon:l.Z,label:"發送"},{path:"/inbox",icon:d.Z,label:"收件箱"},{path:"/settings",icon:i.Z,label:"設定"}],r=e=>"/home"===e?"/home"===t:null==t?void 0:t.startsWith(e);return(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border z-50",children:(0,s.jsx)("div",{className:"max-w-md mx-auto",children:(0,s.jsx)("div",{className:"grid grid-cols-4",children:a.map(t=>{let a=t.icon,n=r(t.path);return(0,s.jsxs)("button",{onClick:()=>e.push(t.path),className:(0,c.cn)("flex flex-col items-center justify-center gap-1 py-3 transition-colors",n?"text-primary":"text-muted-foreground hover:text-foreground"),children:[(0,s.jsx)(a,{className:"h-5 w-5",strokeWidth:n?2.5:1.5}),(0,s.jsx)("span",{className:"text-xs",children:t.label})]},t.path)})})})})});u.displayName="BottomNav",t.Z=u},3842:function(e,t,a){"use strict";a.d(t,{z:function(){return i}});var s=a(7821),r=a(8078),n=a(7035),o=a(898),l=a(7211);let d=(0,o.j)('inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*="size-"])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary-dark",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border bg-background text-foreground hover:bg-muted",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-md px-6",icon:"size-11 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),i=r.forwardRef((e,t)=>{let{className:a,variant:r,size:o,asChild:i=!1,...c}=e,u=i?n.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(d({variant:r,size:o,className:a})),ref:t,...c})});i.displayName="Button"},8006:function(e,t,a){"use strict";a.d(t,{Zb:function(){return o}});var s=a(7821),r=a(8078),n=a(7211);let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("bg-card text-card-foreground rounded-2xl border shadow-sm",a),...r})});o.displayName="Card",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-xl font-semibold leading-none tracking-tight",a),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})}).displayName="CardDescription",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})}).displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},3759:function(e,t,a){"use strict";a.d(t,{$N:function(){return p},Be:function(){return f},Vq:function(){return d},cN:function(){return x},cZ:function(){return u},fK:function(){return m}});var s=a(7821),r=a(8078),n=a(9551),o=a(3116),l=a(7211);let d=n.fC;n.xz;let i=n.h_;n.x8;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});c.displayName=n.aV.displayName;let u=r.forwardRef((e,t)=>{let{className:a,children:r,...d}=e;return(0,s.jsxs)(i,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)(n.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[r,(0,s.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=n.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="DialogFooter";let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});p.displayName=n.Dx.displayName;let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});f.displayName=n.dk.displayName},3507:function(e,t,a){"use strict";a.d(t,{g:function(){return o}});var s=a(7821),r=a(8078),n=a(7211);let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...r})});o.displayName="Textarea"},3923:function(e,t,a){"use strict";a.d(t,{q:function(){return c},w:function(){return i}});var s=a(7821),r=a(8078),n=a(8504),o=a(4680),l=a(3295);let d=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[c,u]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[p,f]=(0,r.useState)(!0),h=(0,n.useRouter)(),g=(0,r.useCallback)(async()=>{try{let e=await l.g8.getMe();i(e),localStorage.setItem("user",JSON.stringify(e))}catch(e){console.error("Failed to refresh user:",e),e instanceof Error&&e.message.includes("401")&&(localStorage.removeItem("token"),localStorage.removeItem("user"),i(null))}},[]),v=(0,r.useCallback)(async()=>{try{let e=await l.Mp.getAll();u(e)}catch(e){console.error("Failed to refresh messages:",e)}},[]),b=(0,r.useCallback)(async()=>{try{let e=await l.Wp.getHistory();x(e)}catch(e){console.error("Failed to refresh point history:",e)}},[]);(0,r.useEffect)(()=>{(async()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{let e=JSON.parse(t);i(e),await g(),await v(),await b()}catch(e){console.error("Failed to load user:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),i(null)}}f(!1)})()},[]);let y=async(e,t)=>{try{let a;a=t.startsWith("eyJ")?{access_token:t,user:await l.g8.getMe()}:await l.iJ.login(e,t),localStorage.setItem("token",a.access_token),localStorage.setItem("user",JSON.stringify(a.user)),i(a.user),await v(),await b(),o.Am.success("登入成功"),h.push(a.user.hasCompletedOnboarding?"/home":"/onboarding")}catch(e){var a,s;throw o.Am.error((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||"登入失敗"),e}},N=async e=>{try{let t=await l.g8.updateMe(e);i(t),localStorage.setItem("user",JSON.stringify(t)),o.Am.success("更新成功")}catch(e){var t,a;throw o.Am.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"更新失敗"),e}};return(0,s.jsx)(d.Provider,{value:{user:a,messages:c,pointHistory:m,isLoading:p,login:y,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),i(null),u([]),x([]),h.push("/landing"),o.Am.success("已登出")},updateUser:N,refreshUser:g,refreshMessages:v,refreshPointHistory:b},children:t})}function c(){let e=(0,r.useContext)(d);if(void 0===e)throw Error("useApp must be used within AppProvider");return e}},3295:function(e,t,a){"use strict";a.d(t,{no:function(){return d},iJ:function(){return r},S9:function(){return i},Mp:function(){return o},Wp:function(){return l},g8:function(){return n}});let s=a(9190).Z.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),s.interceptors.response.use(e=>e,e=>{var t,a,s,r,n,o,l,d,i,c,u,m,x;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(null===(s=e.config)||void 0===s?void 0:null===(a=s.url)||void 0===a?void 0:a.includes("/auth/verify-phone"))===!1&&(null===(n=e.config)||void 0===n?void 0:null===(r=n.url)||void 0===r?void 0:r.includes("/auth/check-phone"))===!1&&(null===(l=e.config)||void 0===l?void 0:null===(o=l.url)||void 0===o?void 0:o.includes("/auth/reset-verify-count"))===!1&&(null===(i=e.config)||void 0===i?void 0:null===(d=i.url)||void 0===d?void 0:d.includes("/auth/login"))===!1&&(null===(u=e.config)||void 0===u?void 0:null===(c=u.url)||void 0===c?void 0:c.includes("/auth/set-password"))===!1&&(null===(x=e.config)||void 0===x?void 0:null===(m=x.url)||void 0===m?void 0:m.includes("/auth/reset-password"))===!1&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let r={checkPhone:e=>s.get("/auth/check-phone/".concat(e)).then(e=>e.data),verifyPhone:e=>s.post("/auth/verify-phone",{phone:e}).then(e=>e.data),login:(e,t)=>s.post("/auth/login",{phone:e,code:t}).then(e=>e.data),passwordLogin:(e,t)=>s.post("/auth/password-login",{phone:e,password:t}).then(e=>e.data),setPassword:(e,t,a)=>s.post("/auth/set-password",{phone:e,code:t,password:a}).then(e=>e.data),resetPassword:(e,t,a)=>s.post("/auth/reset-password",{phone:e,code:t,newPassword:a}).then(e=>e.data),resetVerifyCount:e=>s.post("/auth/reset-verify-count",{phone:e}).then(e=>e.data)},n={getMe:()=>s.get("/users/me").then(e=>e.data),updateMe:e=>s.put("/users/me",e).then(e=>e.data),completeOnboarding:e=>s.put("/users/me/onboarding",e).then(e=>e.data),findByLicensePlate:e=>s.get("/users/license-plate/".concat(e)).then(e=>e.data),blockUser:e=>s.post("/users/block",{userId:e}).then(e=>e.data),unblockUser:e=>s.delete("/users/block/".concat(e)).then(e=>e.data),rejectUser:e=>s.post("/users/reject",{userId:e}).then(e=>e.data),unrejectUser:e=>s.delete("/users/reject/".concat(e)).then(e=>e.data),getBlockedList:()=>s.get("/users/blocked").then(e=>e.data),getRejectedList:()=>s.get("/users/rejected").then(e=>e.data)},o={create:e=>s.post("/messages",e).then(e=>e.data),getAll:e=>s.get("/messages",{params:{unreadOnly:e}}).then(e=>e.data),getSent:()=>s.get("/messages/sent").then(e=>e.data),getOne:e=>s.get("/messages/".concat(e)).then(e=>e.data),markAsRead:e=>s.post("/messages/".concat(e,"/read")).then(e=>e.data),reply:(e,t)=>s.post("/messages/".concat(e,"/reply"),{replyText:t}).then(e=>e.data),report:(e,t)=>s.post("/messages/".concat(e,"/report"),{reason:t}).then(e=>e.data)},l={getBalance:()=>s.get("/points/balance").then(e=>e.data),getHistory:()=>s.get("/points/history").then(e=>e.data),recharge:e=>s.post("/points/recharge",{amount:e}).then(e=>e.data)},d={checkLimit:()=>s.get("/ai/rewrite/limit").then(e=>e.data),rewrite:e=>s.post("/ai/rewrite",{text:e}).then(e=>e.data)},i={checkAvailability:e=>s.get("/users/check-license-plate/".concat(e)).then(e=>e.data),createApplication:e=>s.post("/users/license-plate-application",e).then(e=>e.data),getMyApplications:()=>s.get("/users/license-plate-application").then(e=>e.data),getApplication:e=>s.get("/users/license-plate-application/".concat(e)).then(e=>e.data)}},7211:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var s=a(2605),r=a(1638);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}}},function(e){e.O(0,[163,900,725,357,663,471,115,253,744],function(){return e(e.s=8471)}),_N_E=e.O()}]);