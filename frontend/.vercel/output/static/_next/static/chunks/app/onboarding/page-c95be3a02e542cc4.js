(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{6653:function(e,t,r){Promise.resolve().then(r.bind(r,9313))},9313:function(e,t,r){"use strict";r.r(t);var s=r(7821),a=r(8078),n=r(8504),l=r(3923),i=r(3842),o=r(8006),c=r(5231),d=r(9367),u=r(641),m=r(7296),x=r(687),h=r(9198),p=r(4680),f=r(3295),g=r(1188),v=r(3759);let b=a.memo(()=>{let e=(0,n.useRouter)(),{user:t,refreshUser:r}=(0,l.q)(),[b,y]=(0,a.useState)(1),[j,N]=(0,a.useState)(null),[w,k]=(0,a.useState)(null),[C,A]=(0,a.useState)(""),[S,Z]=(0,a.useState)(""),[I,z]=(0,a.useState)(!1),[R,P]=(0,a.useState)(!1),[M,_]=(0,a.useState)(null),[B,D]=(0,a.useState)(!1),[O,F]=(0,a.useState)(""),$=(e,t)=>{N(e),t&&k(t),y(3)},q=async()=>{if(C.trim())try{await f.g8.updateMe({nickname:C.trim()}),await r()}catch(e){console.error("Failed to update nickname:",e)}"pedestrian"===j?y(5):y(4)},L=async()=>{if(!S)return;let e=(0,g.qX)(S);if(!e){p.Am.error("車牌號碼格式無效");return}z(!0);try{let t=await f.S9.checkAvailability(e);if(t.isBound){_({isBound:!0,boundPhone:t.boundPhone,boundNickname:t.boundNickname}),P(!0),z(!1);return}try{await f.g8.updateMe({licensePlate:e}),await r()}catch(e){console.error("Failed to update license plate:",e)}y(5)}catch(e){var t,s;p.Am.error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"檢查車牌失敗")}finally{z(!1)}},U=async()=>{if(S){z(!0);try{let e=(0,g.qX)(S);if(!e){p.Am.error("車牌號碼格式無效"),z(!1);return}await f.S9.createApplication({licensePlate:e,vehicleType:w||void 0,licenseImage:O||void 0}),p.Am.success("申請已提交，我們會在 1-2 個工作天內以簡訊回覆"),D(!1),y(5)}catch(r){var e,t;p.Am.error((null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"提交申請失敗")}finally{z(!1)}}},V=async()=>{if(j){z(!0);try{let t=S?(0,g.qX)(S):void 0;if(S&&!t){p.Am.error("車牌號碼格式無效"),z(!1);return}await f.g8.completeOnboarding({userType:j,vehicleType:w||void 0,licensePlate:t||void 0,nickname:C||void 0}),await r(),p.Am.success("註冊完成！"),e.push("/home")}catch(e){var t,s;p.Am.error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"完成註冊失敗")}finally{z(!1)}}},W="pedestrian"===j?5:6,J="pedestrian"===j&&b>4?b-1:b;return(0,s.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,s.jsx)("div",{className:"bg-card border-b border-border",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center justify-between relative",children:[(0,s.jsxs)("button",{onClick:()=>{1===b?e.push("/login"):2===b?y(1):3===b?y(2):4===b?y(3):5===b?"pedestrian"===j?y(3):y(4):6===b&&y(5)},className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,s.jsx)(u.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,s.jsxs)("h1",{className:"text-base text-foreground absolute left-1/2 -translate-x-1/2",children:["註冊流程 (",J,"/",W,")"]}),(0,s.jsx)("div",{className:"w-[80px]"})]})}),(0,s.jsxs)("div",{className:"max-w-md mx-auto p-6",children:[(0,s.jsx)("div",{className:"flex justify-center gap-2 mb-6",children:Array.from({length:W},(e,t)=>t+1).map(e=>(0,s.jsx)("div",{className:"h-1.5 rounded-full transition-all ".concat(e===J?"w-8 bg-primary":e<J?"w-1.5 bg-primary/30":"w-1.5 bg-border")},e))}),1===b&&(0,s.jsxs)(o.Zb,{className:"p-6 space-y-6 bg-card border-border shadow-none",children:[(0,s.jsxs)("div",{className:"space-y-3 text-center",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"這不是聊天平台"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:["我們希望把路上的衝突",(0,s.jsx)("br",{}),"變成私密、短暫、不擴散的提醒"]})]}),(0,s.jsx)(i.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:()=>y(2),children:"下一步"})]}),2===b&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-medium mb-2",children:"你是哪一種用路人？"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"選擇你的身分"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("button",{onClick:()=>$("driver","car"),className:"w-full p-6 bg-card border-2 border-border hover:border-primary hover:bg-primary/5 rounded-2xl transition-all active:scale-95",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(m.Z,{className:"h-8 w-8 text-primary",strokeWidth:1.5}),(0,s.jsxs)("div",{className:"flex-1 text-left",children:[(0,s.jsx)("p",{className:"font-medium text-foreground",children:"汽車駕駛"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"需填寫車牌｜可發送、可接收提醒"})]})]})}),(0,s.jsx)("button",{onClick:()=>$("driver","scooter"),className:"w-full p-6 bg-card border-2 border-border hover:border-primary hover:bg-primary/5 rounded-2xl transition-all active:scale-95",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(x.Z,{className:"h-8 w-8 text-primary",strokeWidth:1.5}),(0,s.jsxs)("div",{className:"flex-1 text-left",children:[(0,s.jsx)("p",{className:"font-medium text-foreground",children:"機車騎士"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"需填寫車牌｜可發送、可接收提醒"})]})]})}),(0,s.jsx)("button",{onClick:()=>$("pedestrian"),className:"w-full p-6 bg-card border-2 border-border hover:border-primary hover:bg-primary/5 rounded-2xl transition-all active:scale-95",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(h.Z,{className:"h-8 w-8 text-primary",strokeWidth:1.5}),(0,s.jsxs)("div",{className:"flex-1 text-left",children:[(0,s.jsx)("p",{className:"font-medium text-foreground",children:"行人/腳踏車"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"不需車牌｜只能發送提醒"})]})]})})]}),(0,s.jsx)(o.Zb,{className:"p-4 bg-muted/30 border-border",children:(0,s.jsx)("p",{className:"text-xs text-muted-foreground text-center leading-relaxed",children:"\uD83D\uDCA1 行人/腳踏車用戶因沒有車牌，無法接收其他人的提醒"})})]}),3===b&&(0,s.jsxs)(o.Zb,{className:"p-6 space-y-6 bg-card border-border shadow-none",children:[(0,s.jsxs)("div",{className:"space-y-3 text-center",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"設定暱稱（可選）"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["暱稱會在訊息中以匿名方式顯示",(0,s.jsx)("br",{}),"不設定也可以使用所有功能"]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(d._,{htmlFor:"nickname",className:"text-sm text-foreground",children:"暱稱"}),(0,s.jsx)(c.I,{id:"nickname",type:"text",placeholder:"例如：熱心駕駛",value:C,onChange:e=>A(e.target.value),maxLength:12}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"最多 12 個字元"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:q,children:C.trim()?"設定暱稱並繼續":"跳過"}),C.trim()&&(0,s.jsx)("button",{onClick:()=>{A(""),q()},className:"w-full text-sm text-muted-foreground hover:text-foreground transition-colors py-2",children:"跳過暱稱設定"})]})]}),4===b&&"driver"===j&&(0,s.jsxs)(o.Zb,{className:"p-6 space-y-6 bg-card border-border shadow-none",children:[(0,s.jsxs)("div",{className:"space-y-3 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4",children:["car"===w?(0,s.jsx)(m.Z,{className:"h-6 w-6 text-primary",strokeWidth:1.5}):(0,s.jsx)(x.Z,{className:"h-6 w-6 text-primary",strokeWidth:1.5}),(0,s.jsx)("span",{className:"text-sm font-medium text-primary",children:"car"===w?"汽車駕駛":"機車騎士"})]}),(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"填寫車牌號碼"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"僅用於接收提醒，不會公開顯示"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(d._,{htmlFor:"licensePlate",className:"text-sm text-foreground",children:"car"===w?"汽車車牌":"機車車牌"}),(0,s.jsx)(c.I,{id:"licensePlate",type:"text",placeholder:"car"===w?"ABC1234":"ABC123",value:S,onChange:e=>{Z(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,""))},maxLength:8,className:"text-center font-mono tracking-wider"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"car"===w?"格式範例：ABC1234（可不輸入連字符）":"格式範例：ABC123（可不輸入連字符）"})]}),(0,s.jsx)(i.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:L,disabled:!S,children:"下一步"})]}),5===b&&(0,s.jsxs)(o.Zb,{className:"p-6 space-y-6 bg-card border-border shadow-none",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h2",{className:"text-xl text-foreground",children:["這裡的每一次提醒",(0,s.jsx)("br",{}),"都需要點數"]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm text-left bg-muted/50 p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"•"}),(0,s.jsx)("span",{className:"text-foreground",children:"提醒會消耗點數"})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"•"}),(0,s.jsx)("span",{className:"text-foreground",children:"讚美可以獲得少量點數"})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"•"}),(0,s.jsx)("span",{className:"text-foreground",children:"不公開車牌、不公開個人資訊"})]})]}),(0,s.jsx)("div",{className:"bg-primary/5 border-2 border-primary/30 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-sm font-medium text-primary-dark",children:"\uD83C\uDF81 新手禮包：8 點免費體驗"})})]}),(0,s.jsx)(i.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:()=>y(6),children:"下一步"})]}),6===b&&(0,s.jsxs)(o.Zb,{className:"p-6 space-y-6 bg-card border-border shadow-none",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-primary/10 rounded-full mx-auto flex items-center justify-center",children:"pedestrian"===j?(0,s.jsx)(h.Z,{className:"h-8 w-8 text-primary"}):"car"===w?(0,s.jsx)(m.Z,{className:"h-8 w-8 text-primary"}):(0,s.jsx)(x.Z,{className:"h-8 w-8 text-primary"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl text-foreground mb-2",children:"pedestrian"===j?"歡迎加入！":"歡迎上路！"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"pedestrian"===j?"你可以開始發送提醒給其他用路人":"你已獲得 8 點免費體驗點數"})]}),"pedestrian"===j&&(0,s.jsxs)("div",{className:"bg-muted/30 border border-border rounded-lg p-4 text-left",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"行人用戶說明："}),(0,s.jsxs)("ul",{className:"space-y-1 text-xs text-foreground",children:[(0,s.jsx)("li",{children:"✅ 可以發送提醒給汽車/機車駕駛"}),(0,s.jsx)("li",{children:"✅ 獲得 8 點新手禮包"}),(0,s.jsx)("li",{children:"⚠️ 無法收到提醒（因為沒有車牌）"})]})]})]}),(0,s.jsx)(i.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:V,disabled:I,children:I?"處理中...":"開始使用"})]})]}),(0,s.jsx)(v.Vq,{open:R,onOpenChange:P,children:(0,s.jsxs)(v.cZ,{children:[(0,s.jsxs)(v.fK,{children:[(0,s.jsx)(v.$N,{children:"車牌已被登記"}),(0,s.jsxs)(v.Be,{children:["該車牌號碼 ",(0,s.jsx)("strong",{children:S.toUpperCase()})," 已被綁定到手機號碼"," ",(0,s.jsx)("strong",{children:null==M?void 0:M.boundPhone}),(null==M?void 0:M.boundNickname)&&" (".concat(M.boundNickname,")"),"。",(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),"這是否為您的車輛？"]})]}),(0,s.jsxs)(v.cN,{children:[(0,s.jsx)(i.z,{variant:"outline",onClick:()=>{P(!1),Z("")},children:"不是，重新輸入"}),(0,s.jsx)(i.z,{onClick:()=>{P(!1),D(!0)},children:"是，提交申請"})]})]})}),(0,s.jsx)(v.Vq,{open:B,onOpenChange:D,children:(0,s.jsxs)(v.cZ,{className:"max-w-md",children:[(0,s.jsxs)(v.fK,{children:[(0,s.jsx)(v.$N,{children:"提交車牌申請"}),(0,s.jsx)(v.Be,{children:"請上傳行照照片（需包含車牌資料），我們會在 1-2 個工作天內審核並以簡訊回覆。"})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d._,{htmlFor:"licenseImage",children:"行照照片"}),(0,s.jsx)(c.I,{id:"licenseImage",type:"text",placeholder:"請輸入圖片 URL（或使用圖片上傳服務）",value:O,onChange:e=>F(e.target.value)}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"提示：您可以先將照片上傳到圖床服務（如 imgur），然後貼上 URL"})]}),(0,s.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg",children:[(0,s.jsx)("p",{className:"text-sm text-foreground font-medium mb-2",children:"申請資訊"}),(0,s.jsxs)("div",{className:"space-y-1 text-sm text-muted-foreground",children:[(0,s.jsxs)("p",{children:["車牌號碼：",S.toUpperCase()]}),(0,s.jsxs)("p",{children:["車輛類型：","car"===w?"汽車":"機車"]})]})]})]}),(0,s.jsxs)(v.cN,{children:[(0,s.jsx)(i.z,{variant:"outline",onClick:()=>D(!1),children:"取消"}),(0,s.jsx)(i.z,{onClick:U,disabled:I,children:I?"提交中...":"提交申請"})]})]})})]})});b.displayName="OnboardingPage",t.default=b},3842:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(7821),a=r(8078),n=r(7035),l=r(898),i=r(7211);let o=(0,l.j)('inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*="size-"])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary-dark",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border bg-background text-foreground hover:bg-muted",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-md px-6",icon:"size-11 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:l,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,s.jsx)(u,{className:(0,i.cn)(o({variant:a,size:l,className:r})),ref:t,...d})});c.displayName="Button"},8006:function(e,t,r){"use strict";r.d(t,{Zb:function(){return l}});var s=r(7821),a=r(8078),n=r(7211);let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("bg-card text-card-foreground rounded-2xl border shadow-sm",r),...a})});l.displayName="Card",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})}).displayName="CardHeader",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-xl font-semibold leading-none tracking-tight",r),...a})}).displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})}).displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},3759:function(e,t,r){"use strict";r.d(t,{$N:function(){return h},Be:function(){return p},Vq:function(){return o},cN:function(){return x},cZ:function(){return u},fK:function(){return m}});var s=r(7821),a=r(8078),n=r(9551),l=r(3116),i=r(7211);let o=n.fC;n.xz;let c=n.h_;n.x8;let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...a})});d.displayName=n.aV.displayName;let u=a.forwardRef((e,t)=>{let{className:r,children:a,...o}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(d,{}),(0,s.jsxs)(n.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...o,children:[a,(0,s.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=n.VY.displayName;let m=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};m.displayName="DialogHeader";let x=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};x.displayName="DialogFooter";let h=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",r),...a})});h.displayName=n.Dx.displayName;let p=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...a})});p.displayName=n.dk.displayName},5231:function(e,t,r){"use strict";r.d(t,{I:function(){return l}});var s=r(7821),a=r(8078),n=r(7211);let l=a.forwardRef((e,t)=>{let{className:r,type:a,...l}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-11 w-full rounded-lg border border-input bg-input px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});l.displayName="Input"},9367:function(e,t,r){"use strict";r.d(t,{_:function(){return i}});var s=r(7821),a=r(8078),n=r(255),l=r(7211);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.f,{ref:t,className:(0,l.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",r),...a})});i.displayName=n.f.displayName},3923:function(e,t,r){"use strict";r.d(t,{q:function(){return d},w:function(){return c}});var s=r(7821),a=r(8078),n=r(8504),l=r(4680),i=r(3295);let o=(0,a.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[d,u]=(0,a.useState)([]),[m,x]=(0,a.useState)([]),[h,p]=(0,a.useState)(!0),f=(0,n.useRouter)(),g=(0,a.useCallback)(async()=>{try{let e=await i.g8.getMe();c(e),localStorage.setItem("user",JSON.stringify(e))}catch(e){console.error("Failed to refresh user:",e),e instanceof Error&&e.message.includes("401")&&(localStorage.removeItem("token"),localStorage.removeItem("user"),c(null))}},[]),v=(0,a.useCallback)(async()=>{try{let e=await i.Mp.getAll();u(e)}catch(e){console.error("Failed to refresh messages:",e)}},[]),b=(0,a.useCallback)(async()=>{try{let e=await i.Wp.getHistory();x(e)}catch(e){console.error("Failed to refresh point history:",e)}},[]);(0,a.useEffect)(()=>{(async()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{let e=JSON.parse(t);c(e),await g(),await v(),await b()}catch(e){console.error("Failed to load user:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),c(null)}}p(!1)})()},[]);let y=async(e,t)=>{try{let r;r=t.startsWith("eyJ")?{access_token:t,user:await i.g8.getMe()}:await i.iJ.login(e,t),localStorage.setItem("token",r.access_token),localStorage.setItem("user",JSON.stringify(r.user)),c(r.user),await v(),await b(),l.Am.success("登入成功"),f.push(r.user.hasCompletedOnboarding?"/home":"/onboarding")}catch(e){var r,s;throw l.Am.error((null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"登入失敗"),e}},j=async e=>{try{let t=await i.g8.updateMe(e);c(t),localStorage.setItem("user",JSON.stringify(t)),l.Am.success("更新成功")}catch(e){var t,r;throw l.Am.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"更新失敗"),e}};return(0,s.jsx)(o.Provider,{value:{user:r,messages:d,pointHistory:m,isLoading:h,login:y,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),c(null),u([]),x([]),f.push("/landing"),l.Am.success("已登出")},updateUser:j,refreshUser:g,refreshMessages:v,refreshPointHistory:b},children:t})}function d(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useApp must be used within AppProvider");return e}},3295:function(e,t,r){"use strict";r.d(t,{no:function(){return o},iJ:function(){return a},S9:function(){return c},Mp:function(){return l},Wp:function(){return i},g8:function(){return n}});let s=r(9190).Z.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),s.interceptors.response.use(e=>e,e=>{var t,r,s,a,n,l,i,o,c,d,u,m,x;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(null===(s=e.config)||void 0===s?void 0:null===(r=s.url)||void 0===r?void 0:r.includes("/auth/verify-phone"))===!1&&(null===(n=e.config)||void 0===n?void 0:null===(a=n.url)||void 0===a?void 0:a.includes("/auth/check-phone"))===!1&&(null===(i=e.config)||void 0===i?void 0:null===(l=i.url)||void 0===l?void 0:l.includes("/auth/reset-verify-count"))===!1&&(null===(c=e.config)||void 0===c?void 0:null===(o=c.url)||void 0===o?void 0:o.includes("/auth/login"))===!1&&(null===(u=e.config)||void 0===u?void 0:null===(d=u.url)||void 0===d?void 0:d.includes("/auth/set-password"))===!1&&(null===(x=e.config)||void 0===x?void 0:null===(m=x.url)||void 0===m?void 0:m.includes("/auth/reset-password"))===!1&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let a={checkPhone:e=>s.get("/auth/check-phone/".concat(e)).then(e=>e.data),verifyPhone:e=>s.post("/auth/verify-phone",{phone:e}).then(e=>e.data),login:(e,t)=>s.post("/auth/login",{phone:e,code:t}).then(e=>e.data),passwordLogin:(e,t)=>s.post("/auth/password-login",{phone:e,password:t}).then(e=>e.data),setPassword:(e,t,r)=>s.post("/auth/set-password",{phone:e,code:t,password:r}).then(e=>e.data),resetPassword:(e,t,r)=>s.post("/auth/reset-password",{phone:e,code:t,newPassword:r}).then(e=>e.data),resetVerifyCount:e=>s.post("/auth/reset-verify-count",{phone:e}).then(e=>e.data)},n={getMe:()=>s.get("/users/me").then(e=>e.data),updateMe:e=>s.put("/users/me",e).then(e=>e.data),completeOnboarding:e=>s.put("/users/me/onboarding",e).then(e=>e.data),findByLicensePlate:e=>s.get("/users/license-plate/".concat(e)).then(e=>e.data),blockUser:e=>s.post("/users/block",{userId:e}).then(e=>e.data),unblockUser:e=>s.delete("/users/block/".concat(e)).then(e=>e.data),rejectUser:e=>s.post("/users/reject",{userId:e}).then(e=>e.data),unrejectUser:e=>s.delete("/users/reject/".concat(e)).then(e=>e.data),getBlockedList:()=>s.get("/users/blocked").then(e=>e.data),getRejectedList:()=>s.get("/users/rejected").then(e=>e.data)},l={create:e=>s.post("/messages",e).then(e=>e.data),getAll:e=>s.get("/messages",{params:{unreadOnly:e}}).then(e=>e.data),getSent:()=>s.get("/messages/sent").then(e=>e.data),getOne:e=>s.get("/messages/".concat(e)).then(e=>e.data),markAsRead:e=>s.post("/messages/".concat(e,"/read")).then(e=>e.data),reply:(e,t)=>s.post("/messages/".concat(e,"/reply"),{replyText:t}).then(e=>e.data),report:(e,t)=>s.post("/messages/".concat(e,"/report"),{reason:t}).then(e=>e.data)},i={getBalance:()=>s.get("/points/balance").then(e=>e.data),getHistory:()=>s.get("/points/history").then(e=>e.data),recharge:e=>s.post("/points/recharge",{amount:e}).then(e=>e.data)},o={checkLimit:()=>s.get("/ai/rewrite/limit").then(e=>e.data),rewrite:e=>s.post("/ai/rewrite",{text:e}).then(e=>e.data)},c={checkAvailability:e=>s.get("/users/check-license-plate/".concat(e)).then(e=>e.data),createApplication:e=>s.post("/users/license-plate-application",e).then(e=>e.data),getMyApplications:()=>s.get("/users/license-plate-application").then(e=>e.data),getApplication:e=>s.get("/users/license-plate-application/".concat(e)).then(e=>e.data)}},1188:function(e,t,r){"use strict";function s(e){return e?e.replace(/[^A-Za-z0-9]/g,"").toUpperCase():""}function a(e){let t=s(e);return t.length<3||t.length>8||!/[A-Z]/.test(t)||!/[0-9]/.test(t)?null:t}function n(e){if(!e)return"";let t=s(e);if(7===t.length){if(/^[A-Z]{3}[0-9]{4}$/.test(t))return"".concat(t.slice(0,3),"-").concat(t.slice(3));if(/^[0-9]{4}[A-Z]{3}$/.test(t))return"".concat(t.slice(0,4),"-").concat(t.slice(4))}else if(6===t.length){if(/^[A-Z]{3}[0-9]{3}$/.test(t))return"".concat(t.slice(0,3),"-").concat(t.slice(3));if(/^[A-Z]{2}[0-9]{4}$/.test(t))return"".concat(t.slice(0,2),"-").concat(t.slice(2));if(/^[0-9]{3}[A-Z]{3}$/.test(t))return"".concat(t.slice(0,3),"-").concat(t.slice(3))}else if(5===t.length){if(/^[A-Z]{2}[0-9]{3}$/.test(t))return"".concat(t.slice(0,2),"-").concat(t.slice(2));if(/^[0-9]{3}[A-Z]{2}$/.test(t))return"".concat(t.slice(0,3),"-").concat(t.slice(3))}return t}r.d(t,{qX:function(){return a},uk:function(){return n}})},7211:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var s=r(2605),a=r(1638);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}},687:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(6576).Z)("bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]])},7296:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(6576).Z)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])},9198:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(6576).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},255:function(e,t,r){"use strict";r.d(t,{f:function(){return o}});var s=r(8078);r(457);var a=r(7035),n=r(7821),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,a.Z8)(`Primitive.${t}`),l=s.forwardRef((e,s)=>{let{asChild:a,...l}=e,i=a?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(i,{...l,ref:s})});return l.displayName=`Primitive.${t}`,{...e,[t]:l}},{}),i=s.forwardRef((e,t)=>(0,n.jsx)(l.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null===(r=e.onMouseDown)||void 0===r||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var o=i}},function(e){e.O(0,[163,900,725,115,253,744],function(){return e(e.s=6653)}),_N_E=e.O()}]);