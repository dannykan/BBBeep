(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{1786:function(e,t,r){Promise.resolve().then(r.bind(r,3036))},3036:function(e,t,r){"use strict";r.r(t);var s=r(7821),a=r(8078),n=r(8504),o=r(3923),l=r(3842),i=r(5231),c=r(9367),d=r(4362),u=r(5836),m=r(8006),h=r(641),g=r(4680),p=r(3295);let f=a.memo(()=>{let e=(0,n.useRouter)(),{login:t,refreshUser:r,refreshMessages:f,refreshPointHistory:x}=(0,o.q)(),[v,y]=(0,a.useState)("phone"),[b,w]=(0,a.useState)(""),[N,j]=(0,a.useState)(""),[k,S]=(0,a.useState)(""),[A,I]=(0,a.useState)(""),[C,P]=(0,a.useState)(""),[_,J]=(0,a.useState)(180),[R,O]=(0,a.useState)(!1),[z,F]=(0,a.useState)(!1),[Z,L]=(0,a.useState)(null),[T,E]=(0,a.useState)(null),[W,M]=(0,a.useState)(0),[B,D]=(0,a.useState)(0),H=async()=>{var e,t,r,s,a;if(!/^09\d{8}$/.test(b)){g.Am.error("請輸入正確的手機號碼格式");return}F(!0);try{let s=await p.iJ.checkPhone(b);if(s.exists&&s.hasPassword)L(!0),y("login");else{L(!1);try{let t=await p.iJ.verifyPhone(b);E(null!==(e=t.remaining)&&void 0!==e?e:null),y("otp"),J(180),g.Am.success("驗證碼已發送")}catch(s){let e=(null===(r=s.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"發送驗證碼失敗";g.Am.error(e);return}}}catch(e){g.Am.error((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"檢查失敗")}finally{F(!1)}},$=async()=>{var e,t,r;O(!0);try{let t=await p.iJ.verifyPhone(b);E(null!==(e=t.remaining)&&void 0!==e?e:null),y("otp"),J(180),g.Am.success("驗證碼已發送")}catch(e){g.Am.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"發送驗證碼失敗")}finally{O(!1)}},U=async()=>{var e,t,r;O(!0);try{let t=await p.iJ.verifyPhone(b);E(null!==(e=t.remaining)&&void 0!==e?e:null),J(180),S(""),M(0),g.Am.success("驗證碼已重新發送")}catch(e){g.Am.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"發送驗證碼失敗")}finally{O(!1)}},q=async()=>{if(6!==k.length){g.Am.error("請輸入完整的驗證碼");return}O(!0);try{let t=await p.iJ.checkPhone(b);if(t.exists&&t.hasPassword){let t=await p.iJ.login(b,k);M(0),localStorage.setItem("token",t.access_token),localStorage.setItem("user",JSON.stringify(t.user)),r().catch(console.error),f().catch(console.error),x().catch(console.error),g.Am.success("登入成功"),t.user.hasCompletedOnboarding?e.push("/home"):e.push("/onboarding")}else M(0),y("password")}catch(a){var t,s;let e=(null===(s=a.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"驗證失敗";if(e.includes("連續5次輸入錯誤")){g.Am.error(e+"，請重新輸入手機號碼獲取驗證碼"),y("phone"),S(""),M(0);return}let r=e.match(/剩餘 (\d+) 次機會/);r&&M(5-parseInt(r[1],10)),S(""),g.Am.error(e)}finally{O(!1)}},K=async()=>{if(!A){g.Am.error("請輸入密碼");return}if(!/^[a-zA-Z0-9]{6,12}$/.test(A)){g.Am.error("密碼長度應為6-12位，且只能包含英文字母和數字");return}if(A!==C){g.Am.error("兩次輸入的密碼不一致");return}O(!0);try{let t=await p.iJ.setPassword(b,k,A);if(M(0),t.access_token&&t.user)localStorage.setItem("token",t.access_token),localStorage.setItem("user",JSON.stringify(t.user)),r().catch(console.error),f().catch(console.error),x().catch(console.error),g.Am.success("密碼設置成功，即將進入註冊流程"),setTimeout(()=>{e.push("/onboarding")},500);else{let t=await p.iJ.login(b,k);localStorage.setItem("token",t.access_token),localStorage.setItem("user",JSON.stringify(t.user)),r().catch(console.error),f().catch(console.error),x().catch(console.error),g.Am.success("密碼設置成功，即將進入註冊流程"),setTimeout(()=>{e.push("/onboarding")},500)}}catch(a){var t,s;let e=(null===(s=a.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"設置密碼失敗";if(e.includes("連續5次輸入錯誤")){g.Am.error(e+"，請重新輸入手機號碼獲取驗證碼"),y("phone"),S(""),I(""),P(""),M(0);return}let r=e.match(/剩餘 (\d+) 次機會/);r&&M(5-parseInt(r[1],10)),S(""),g.Am.error(e)}finally{O(!1)}},V=async()=>{if(!/^09\d{8}$/.test(b)){g.Am.error("請輸入正確的手機號碼格式");return}if(!N){g.Am.error("請輸入密碼");return}O(!0);try{let t=await p.iJ.passwordLogin(b,N);D(0),localStorage.setItem("token",t.access_token),localStorage.setItem("user",JSON.stringify(t.user)),r().catch(console.error),f().catch(console.error),x().catch(console.error),g.Am.success("登入成功"),t.user.hasCompletedOnboarding?e.push("/home"):e.push("/onboarding")}catch(n){var t,s,a;let r=(null===(s=n.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"登入失敗";if((null===(a=n.response)||void 0===a?void 0:a.status)===401){if(r.includes("尚未設置密碼")){await $();return}if(r.includes("連續5次輸入錯誤")){g.Am.error(r+"，請前往忘記密碼頁面重設密碼"),setTimeout(()=>{e.push("/forgot-password")},1e3);return}let t=r.match(/剩餘 (\d+) 次機會/);t?(parseInt(t[1],10),g.Am.error(r)):g.Am.error("手機號碼或密碼錯誤"),j("")}else g.Am.error(r)}finally{O(!1)}};return a.useEffect(()=>{if("otp"===v&&_>0){let e=setInterval(()=>{J(e=>e<=1?0:e-1)},1e3);return()=>clearInterval(e)}},[v,_]),(0,s.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,s.jsx)("div",{className:"bg-card border-b border-border",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center justify-between relative",children:[(0,s.jsxs)("button",{onClick:()=>{"phone"===v?e.push("/landing"):("login"===v&&Z?(y("phone"),j("")):(y("phone"),j(""),S(""),I(""),P("")),L(null))},className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,s.jsx)(h.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,s.jsx)("h1",{className:"text-base text-foreground absolute left-1/2 -translate-x-1/2",children:(()=>{switch(v){case"phone":default:return"註冊/登入";case"login":return"登入";case"otp":return"驗證碼";case"password":return"設置密碼"}})()}),(0,s.jsx)("div",{className:"w-[80px]"})]})}),(0,s.jsx)("div",{className:"max-w-md mx-auto p-6",children:(0,s.jsxs)(m.Zb,{className:"p-6 space-y-6 bg-card border-border shadow-none",children:["phone"===v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"註冊/登入"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"請輸入手機號碼"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(c._,{htmlFor:"phone",className:"text-sm text-foreground",children:"手機號碼"}),(0,s.jsx)(i.I,{id:"phone",type:"tel",placeholder:"0912345678",value:b,onChange:e=>w(e.target.value.replace(/\D/g,"").slice(0,10)),maxLength:10,className:"h-11 bg-input-background border-border",onKeyDown:e=>{"Enter"===e.key&&10===b.length&&H()}})]}),(0,s.jsx)(l.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:H,disabled:10!==b.length||z,children:z?"檢查中...":"下一步"}),!1]})]}),"login"===v&&Z&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"登入"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"請輸入密碼"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[B>0&&(0,s.jsx)("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-red-600 dark:text-red-400",children:["密碼錯誤 ",B," 次，剩餘 ",5-B," 次機會"]})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(c._,{htmlFor:"password",className:"text-sm text-foreground",children:"密碼"}),(0,s.jsx)(d.W,{id:"password",placeholder:"請輸入密碼",value:N,onChange:e=>{let t=e.target.value;t.length<=12&&j(t),B>0&&D(0)},className:"h-11 bg-input-background border-border ".concat(B>0?"border-red-500 dark:border-red-500":""),autoHideDelay:2e3,maxLength:12,onKeyDown:e=>{"Enter"===e.key&&N&&V()}})]}),(0,s.jsx)(l.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:V,disabled:!N||R,children:R?"登入中...":"登入"}),(0,s.jsx)("button",{onClick:()=>e.push("/forgot-password"),className:"w-full text-sm text-muted-foreground hover:text-foreground text-center",children:"忘記密碼？"})]})]}),"otp"===v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"輸入驗證碼"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["驗證碼已發送至 ",b]}),null!==T&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["今日剩餘發送次數：",T," 次"]}),W>0&&(0,s.jsxs)("p",{className:"text-xs text-destructive",children:["驗證碼錯誤 ",W," 次，剩餘 ",5-W," 次機會"]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(u.Zn,{maxLength:6,value:k,onChange:S,onComplete:q,children:(0,s.jsx)(u.hf,{children:Array.from({length:6}).map((e,t)=>(0,s.jsx)(u.cY,{index:t},t))})})}),(0,s.jsx)("div",{className:"text-center space-y-2",children:_>0?(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["重新發送 (","".concat(Math.floor(_/60),":").concat((_%60).toString().padStart(2,"0")),")"]}):(0,s.jsx)("button",{onClick:U,disabled:R,className:"text-sm text-primary hover:underline",children:"重新發送驗證碼"})}),(0,s.jsx)(l.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:q,disabled:6!==k.length||R,children:R?"驗證中...":"確認"}),(0,s.jsx)("button",{onClick:()=>{y("phone"),S(""),J(180),L(null)},className:"w-full text-sm text-muted-foreground hover:text-foreground",children:"返回"})]})]}),"password"===v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h2",{className:"text-xl text-foreground",children:"設置密碼"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"請輸入6-12位英數密碼"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(c._,{htmlFor:"newPassword",className:"text-sm text-foreground",children:["密碼",A&&(A.length<6||!/^[a-zA-Z0-9]+$/.test(A))&&(0,s.jsx)("span",{className:"ml-2 text-xs text-destructive",children:A.length<6?"（至少6位）":"（只能使用英數）"})]}),(0,s.jsx)(d.W,{id:"newPassword",placeholder:"請輸入密碼",value:A,onChange:e=>{let t=e.target.value;t.length<=12&&I(t)},className:"h-11 bg-input-background ".concat(A&&(A.length<6||!/^[a-zA-Z0-9]+$/.test(A))?"border-destructive":"border-border"),autoHideDelay:2e3,maxLength:12}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"6-12位英數，可大小寫，不可使用符號"}),A&&A.length<6&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:"密碼長度至少需要6位"}),A&&A.length>=6&&!/^[a-zA-Z0-9]+$/.test(A)&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:"密碼只能包含英文字母和數字，不可使用符號"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(c._,{htmlFor:"confirmPassword",className:"text-sm text-foreground",children:["確認密碼",C&&A&&C!==A&&(0,s.jsx)("span",{className:"ml-2 text-xs text-destructive",children:"（密碼不一致）"})]}),(0,s.jsx)(d.W,{id:"confirmPassword",placeholder:"請再次輸入密碼",value:C,onChange:e=>P(e.target.value),className:"h-11 bg-input-background ".concat(C&&A&&C!==A?"border-destructive":"border-border"),autoHideDelay:2e3,onKeyDown:e=>{"Enter"===e.key&&A&&C&&K()}}),C&&A&&C!==A&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:"密碼不一致，請重新輸入"})]}),(0,s.jsx)(l.z,{className:"w-full h-11 bg-primary hover:bg-primary-dark text-white",onClick:K,disabled:!A||!C||A!==C||R,children:R?"設置中...":"確認"})]})]})]})})]})});f.displayName="LoginPage",t.default=f},3842:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(7821),a=r(8078),n=r(7035),o=r(898),l=r(7211);let i=(0,o.j)('inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*="size-"])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary-dark",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border bg-background text-foreground hover:bg-muted",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-md px-6",icon:"size-11 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:o,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(i({variant:a,size:o,className:r})),ref:t,...d})});c.displayName="Button"},8006:function(e,t,r){"use strict";r.d(t,{Zb:function(){return o}});var s=r(7821),a=r(8078),n=r(7211);let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("bg-card text-card-foreground rounded-2xl border shadow-sm",r),...a})});o.displayName="Card",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})}).displayName="CardHeader",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-xl font-semibold leading-none tracking-tight",r),...a})}).displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})}).displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},5836:function(e,t,r){"use strict";r.d(t,{Zn:function(){return l},cY:function(){return c},hf:function(){return i}});var s=r(7821),a=r(8078),n=r(4422),o=r(7211);let l=a.forwardRef((e,t)=>{let{className:r,containerClassName:a,...l}=e;return(0,s.jsx)(n.uZ,{ref:t,containerClassName:(0,o.cn)("flex items-center gap-2",a),className:(0,o.cn)("disabled:cursor-not-allowed",r),...l})});l.displayName="InputOTP";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center",r),...a})});i.displayName="InputOTPGroup";let c=a.forwardRef((e,t)=>{let{index:r,className:l,...i}=e,{char:c,hasFakeCaret:d,isActive:u}=a.useContext(n.VM).slots[r];return(0,s.jsxs)("div",{ref:t,className:(0,o.cn)("relative flex h-11 w-11 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",u&&"z-10 ring-2 ring-ring ring-offset-background",l),...i,children:[c,d&&(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("div",{className:"h-4 w-px animate-caret-blink bg-foreground duration-1000"})})]})});c.displayName="InputOTPSlot"},5231:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var s=r(7821),a=r(8078),n=r(7211);let o=a.forwardRef((e,t)=>{let{className:r,type:a,...o}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-11 w-full rounded-lg border border-input bg-input px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},9367:function(e,t,r){"use strict";r.d(t,{_:function(){return l}});var s=r(7821),a=r(8078),n=r(255),o=r(7211);let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.f,{ref:t,className:(0,o.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",r),...a})});l.displayName=n.f.displayName},4362:function(e,t,r){"use strict";r.d(t,{W:function(){return c}});var s=r(7821),a=r(8078),n=r(534),o=r(2348),l=r(7211),i=r(5231);let c=a.forwardRef((e,t)=>{let{className:r,showToggle:c=!0,autoHideDelay:d=2e3,...u}=e,[m,h]=(0,a.useState)(!1),[g,p]=(0,a.useState)(!1),f=(0,a.useRef)(null);return(0,a.useEffect)(()=>(d>0&&!g&&m&&(f.current=setTimeout(()=>{h(!1)},d)),()=>{f.current&&clearTimeout(f.current)}),[g,m,d]),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(i.I,{...u,ref:t,type:m?"text":"password",className:(0,l.cn)("pr-10",r),onFocus:e=>{p(!0),f.current&&clearTimeout(f.current),u.onFocus&&u.onFocus(e)},onBlur:e=>{p(!1),u.onBlur&&u.onBlur(e)}}),c&&(0,s.jsx)("button",{type:"button",onClick:()=>{h(!m),f.current&&clearTimeout(f.current)},className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",tabIndex:-1,children:m?(0,s.jsx)(n.Z,{className:"h-4 w-4",strokeWidth:1.5}):(0,s.jsx)(o.Z,{className:"h-4 w-4",strokeWidth:1.5})})]})});c.displayName="PasswordInput"},3923:function(e,t,r){"use strict";r.d(t,{q:function(){return d},w:function(){return c}});var s=r(7821),a=r(8078),n=r(8504),o=r(4680),l=r(3295);let i=(0,a.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[d,u]=(0,a.useState)([]),[m,h]=(0,a.useState)([]),[g,p]=(0,a.useState)(!0),f=(0,n.useRouter)(),x=(0,a.useCallback)(async()=>{try{let e=await l.g8.getMe();c(e),localStorage.setItem("user",JSON.stringify(e))}catch(e){console.error("Failed to refresh user:",e),e instanceof Error&&e.message.includes("401")&&(localStorage.removeItem("token"),localStorage.removeItem("user"),c(null))}},[]),v=(0,a.useCallback)(async()=>{try{let e=await l.Mp.getAll();u(e)}catch(e){console.error("Failed to refresh messages:",e)}},[]),y=(0,a.useCallback)(async()=>{try{let e=await l.Wp.getHistory();h(e)}catch(e){console.error("Failed to refresh point history:",e)}},[]);(0,a.useEffect)(()=>{(async()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{let e=JSON.parse(t);c(e),await x(),await v(),await y()}catch(e){console.error("Failed to load user:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),c(null)}}p(!1)})()},[]);let b=async(e,t)=>{try{let r;r=t.startsWith("eyJ")?{access_token:t,user:await l.g8.getMe()}:await l.iJ.login(e,t),localStorage.setItem("token",r.access_token),localStorage.setItem("user",JSON.stringify(r.user)),c(r.user),await v(),await y(),o.Am.success("登入成功"),f.push(r.user.hasCompletedOnboarding?"/home":"/onboarding")}catch(e){var r,s;throw o.Am.error((null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"登入失敗"),e}},w=async e=>{try{let t=await l.g8.updateMe(e);c(t),localStorage.setItem("user",JSON.stringify(t)),o.Am.success("更新成功")}catch(e){var t,r;throw o.Am.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"更新失敗"),e}};return(0,s.jsx)(i.Provider,{value:{user:r,messages:d,pointHistory:m,isLoading:g,login:b,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),c(null),u([]),h([]),f.push("/landing"),o.Am.success("已登出")},updateUser:w,refreshUser:x,refreshMessages:v,refreshPointHistory:y},children:t})}function d(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useApp must be used within AppProvider");return e}},3295:function(e,t,r){"use strict";r.d(t,{no:function(){return i},iJ:function(){return a},S9:function(){return c},Mp:function(){return o},Wp:function(){return l},g8:function(){return n}});let s=r(9190).Z.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),s.interceptors.response.use(e=>e,e=>{var t,r,s,a,n,o,l,i,c,d,u,m,h;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(null===(s=e.config)||void 0===s?void 0:null===(r=s.url)||void 0===r?void 0:r.includes("/auth/verify-phone"))===!1&&(null===(n=e.config)||void 0===n?void 0:null===(a=n.url)||void 0===a?void 0:a.includes("/auth/check-phone"))===!1&&(null===(l=e.config)||void 0===l?void 0:null===(o=l.url)||void 0===o?void 0:o.includes("/auth/reset-verify-count"))===!1&&(null===(c=e.config)||void 0===c?void 0:null===(i=c.url)||void 0===i?void 0:i.includes("/auth/login"))===!1&&(null===(u=e.config)||void 0===u?void 0:null===(d=u.url)||void 0===d?void 0:d.includes("/auth/set-password"))===!1&&(null===(h=e.config)||void 0===h?void 0:null===(m=h.url)||void 0===m?void 0:m.includes("/auth/reset-password"))===!1&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let a={checkPhone:e=>s.get("/auth/check-phone/".concat(e)).then(e=>e.data),verifyPhone:e=>s.post("/auth/verify-phone",{phone:e}).then(e=>e.data),login:(e,t)=>s.post("/auth/login",{phone:e,code:t}).then(e=>e.data),passwordLogin:(e,t)=>s.post("/auth/password-login",{phone:e,password:t}).then(e=>e.data),setPassword:(e,t,r)=>s.post("/auth/set-password",{phone:e,code:t,password:r}).then(e=>e.data),resetPassword:(e,t,r)=>s.post("/auth/reset-password",{phone:e,code:t,newPassword:r}).then(e=>e.data),resetVerifyCount:e=>s.post("/auth/reset-verify-count",{phone:e}).then(e=>e.data)},n={getMe:()=>s.get("/users/me").then(e=>e.data),updateMe:e=>s.put("/users/me",e).then(e=>e.data),completeOnboarding:e=>s.put("/users/me/onboarding",e).then(e=>e.data),findByLicensePlate:e=>s.get("/users/license-plate/".concat(e)).then(e=>e.data),blockUser:e=>s.post("/users/block",{userId:e}).then(e=>e.data),unblockUser:e=>s.delete("/users/block/".concat(e)).then(e=>e.data),rejectUser:e=>s.post("/users/reject",{userId:e}).then(e=>e.data),unrejectUser:e=>s.delete("/users/reject/".concat(e)).then(e=>e.data),getBlockedList:()=>s.get("/users/blocked").then(e=>e.data),getRejectedList:()=>s.get("/users/rejected").then(e=>e.data)},o={create:e=>s.post("/messages",e).then(e=>e.data),getAll:e=>s.get("/messages",{params:{unreadOnly:e}}).then(e=>e.data),getSent:()=>s.get("/messages/sent").then(e=>e.data),getOne:e=>s.get("/messages/".concat(e)).then(e=>e.data),markAsRead:e=>s.post("/messages/".concat(e,"/read")).then(e=>e.data),reply:(e,t)=>s.post("/messages/".concat(e,"/reply"),{replyText:t}).then(e=>e.data),report:(e,t)=>s.post("/messages/".concat(e,"/report"),{reason:t}).then(e=>e.data)},l={getBalance:()=>s.get("/points/balance").then(e=>e.data),getHistory:()=>s.get("/points/history").then(e=>e.data),recharge:e=>s.post("/points/recharge",{amount:e}).then(e=>e.data)},i={checkLimit:()=>s.get("/ai/rewrite/limit").then(e=>e.data),rewrite:e=>s.post("/ai/rewrite",{text:e}).then(e=>e.data)},c={checkAvailability:e=>s.get("/users/check-license-plate/".concat(e)).then(e=>e.data),createApplication:e=>s.post("/users/license-plate-application",e).then(e=>e.data),getMyApplications:()=>s.get("/users/license-plate-application").then(e=>e.data),getApplication:e=>s.get("/users/license-plate-application/".concat(e)).then(e=>e.data)}},7211:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var s=r(2605),a=r(1638);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}}},function(e){e.O(0,[163,900,175,115,253,744],function(){return e(e.s=1786)}),_N_E=e.O()}]);