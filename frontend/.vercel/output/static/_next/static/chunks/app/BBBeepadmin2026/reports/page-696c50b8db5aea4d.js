(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[132],{1088:function(e,s,t){Promise.resolve().then(t.bind(t,844))},844:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var r=t(7821),a=t(8078),n=t(8504),d=t(3842),l=t(8006),i=t(1996),o=t(6576);let c=(0,o.Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var x=t(641);let m=(0,o.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var u=t(4680),f=t(9190),p=t(3759),h=t(3507);let g="http://localhost:3001",j=a.memo(()=>{let e=(0,n.useRouter)(),[s,t]=(0,a.useState)(null),[o,j]=(0,a.useState)([]),[b,N]=(0,a.useState)([]),[v,y]=(0,a.useState)("all"),[w,k]=(0,a.useState)(!1),[z,C]=(0,a.useState)(null),[Z,R]=(0,a.useState)(!1),[S,B]=(0,a.useState)("reviewed"),[_,A]=(0,a.useState)(""),[D,V]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let s=localStorage.getItem("admin_token");s?t(s):e.push("/BBBeepadmin2026")},[e]),(0,a.useEffect)(()=>{s&&T()},[s,v]);let T=async()=>{if(s){k(!0);try{let e={};"all"!==v&&(e.status=v);let t=await f.Z.get("".concat(g,"/admin/message-reports"),{params:e,headers:{"x-admin-token":s}});j(t.data),N(t.data)}catch(s){var t,r,a;(null===(t=s.response)||void 0===t?void 0:t.status)===401?(e.push("/BBBeepadmin2026"),u.Am.error("登入已過期，請重新登入")):u.Am.error((null===(a=s.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"載入檢舉記錄失敗")}finally{k(!1)}}},E=async()=>{if(z&&s){V(!0);try{await f.Z.put("".concat(g,"/admin/message-reports/").concat(z.id,"/review"),{decision:S,adminNote:_.trim()||void 0},{headers:{"x-admin-token":s}}),u.Am.success("審核完成"),R(!1),A(""),C(null),T()}catch(s){var e,t;u.Am.error((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"審核失敗")}finally{V(!1)}}},L=e=>{switch(e){case"pending":return(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:[(0,r.jsx)(i.Z,{className:"h-3 w-3"}),"待審核"]});case"reviewed":return(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:[(0,r.jsx)(c,{className:"h-3 w-3"}),"已審核"]});case"resolved":return(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs bg-green-100 text-green-800",children:[(0,r.jsx)(c,{className:"h-3 w-3"}),"已處理"]});default:return null}},W=o.filter(e=>"pending"===e.status).length,q=o.filter(e=>"reviewed"===e.status).length,M=o.filter(e=>"resolved"===e.status).length;return(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)("div",{className:"bg-card border-b border-border sticky top-0 z-10",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>e.push("/BBBeepadmin2026"),className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,r.jsx)(x.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,r.jsx)("h1",{className:"text-xl font-bold text-foreground flex-1",children:"檢舉訊息管理"})]})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsx)(l.Zb,{className:"p-4 bg-card border-border shadow-none",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"總檢舉數"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-foreground",children:o.length})]}),(0,r.jsx)(m,{className:"h-8 w-8 text-muted-foreground"})]})}),(0,r.jsx)(l.Zb,{className:"p-4 bg-card border-border shadow-none",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"待審核"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:W})]}),(0,r.jsx)(i.Z,{className:"h-8 w-8 text-yellow-600"})]})}),(0,r.jsx)(l.Zb,{className:"p-4 bg-card border-border shadow-none",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"已審核"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:q})]}),(0,r.jsx)(c,{className:"h-8 w-8 text-blue-600"})]})}),(0,r.jsx)(l.Zb,{className:"p-4 bg-card border-border shadow-none",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"已處理"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-600",children:M})]}),(0,r.jsx)(c,{className:"h-8 w-8 text-green-600"})]})})]}),(0,r.jsx)(l.Zb,{className:"p-4 bg-card border-border shadow-none",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d.z,{variant:"all"===v?"default":"outline",size:"sm",onClick:()=>y("all"),children:"全部"}),(0,r.jsx)(d.z,{variant:"pending"===v?"default":"outline",size:"sm",onClick:()=>y("pending"),children:"待審核"}),(0,r.jsx)(d.z,{variant:"reviewed"===v?"default":"outline",size:"sm",onClick:()=>y("reviewed"),children:"已審核"}),(0,r.jsx)(d.z,{variant:"resolved"===v?"default":"outline",size:"sm",onClick:()=>y("resolved"),children:"已處理"})]})}),w?(0,r.jsx)(l.Zb,{className:"p-8 text-center",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"載入中..."})}):0===b.length?(0,r.jsx)(l.Zb,{className:"p-8 text-center",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"沒有檢舉記錄"})}):(0,r.jsx)("div",{className:"space-y-4",children:b.map(e=>(0,r.jsxs)(l.Zb,{className:"p-6 bg-card border-border shadow-none",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[L(e.status),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString("zh-TW")})]})}),"pending"===e.status&&(0,r.jsx)(d.z,{variant:"outline",size:"sm",onClick:()=>{C(e),B("reviewed"),A(""),R(!0)},children:"審核"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"被檢舉的訊息"}),(0,r.jsx)("p",{className:"text-base text-foreground mb-2",children:e.message.template}),e.message.customText&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.message.customText})]}),e.reason&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"檢舉原因"}),(0,r.jsx)("p",{className:"text-sm text-foreground",children:e.reason})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-border",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"檢舉者"}),(0,r.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.reporter.nickname||"匿名"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:e.reporter.phone})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"發送者"}),(0,r.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.message.sender.nickname||"匿名"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:e.message.sender.phone})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"接收者"}),(0,r.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.message.receiver.nickname||"匿名"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:e.message.receiver.phone})]})]}),e.adminNote&&(0,r.jsxs)("div",{className:"pt-4 border-t border-border",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"管理員備註"}),(0,r.jsx)("p",{className:"text-sm text-foreground",children:e.adminNote}),e.reviewedAt&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["審核時間：",new Date(e.reviewedAt).toLocaleString("zh-TW")]})]})]})]},e.id))})]}),(0,r.jsx)(p.Vq,{open:Z,onOpenChange:R,children:(0,r.jsxs)(p.cZ,{children:[(0,r.jsxs)(p.fK,{children:[(0,r.jsx)(p.$N,{children:"審核檢舉"}),(0,r.jsx)(p.Be,{children:"請選擇審核結果並填寫備註（選填）"})]}),(0,r.jsxs)("div",{className:"py-4 space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm text-foreground",children:"審核結果"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d.z,{variant:"reviewed"===S?"default":"outline",size:"sm",onClick:()=>B("reviewed"),children:"已審核"}),(0,r.jsx)(d.z,{variant:"resolved"===S?"default":"outline",size:"sm",onClick:()=>B("resolved"),children:"已處理"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm text-foreground",children:"管理員備註（選填）"}),(0,r.jsx)(h.g,{placeholder:"輸入備註...",value:_,onChange:e=>A(e.target.value),className:"min-h-[100px] resize-none",maxLength:500})]})]}),(0,r.jsxs)(p.cN,{children:[(0,r.jsx)(d.z,{variant:"outline",onClick:()=>R(!1),children:"取消"}),(0,r.jsx)(d.z,{onClick:E,disabled:D,children:D?"處理中...":"確認審核"})]})]})})]})});j.displayName="ReportsPage";var b=j},3842:function(e,s,t){"use strict";t.d(s,{z:function(){return o}});var r=t(7821),a=t(8078),n=t(7035),d=t(898),l=t(7211);let i=(0,d.j)('inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*="size-"])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary-dark",destructive:"bg-destructive text-white hover:bg-destructive/90",outline:"border bg-background text-foreground hover:bg-muted",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-md px-6",icon:"size-11 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,s)=>{let{className:t,variant:a,size:d,asChild:o=!1,...c}=e,x=o?n.g7:"button";return(0,r.jsx)(x,{className:(0,l.cn)(i({variant:a,size:d,className:t})),ref:s,...c})});o.displayName="Button"},8006:function(e,s,t){"use strict";t.d(s,{Zb:function(){return d}});var r=t(7821),a=t(8078),n=t(7211);let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("bg-card text-card-foreground rounded-2xl border shadow-sm",t),...a})});d.displayName="Card",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})}).displayName="CardHeader",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("h3",{ref:s,className:(0,n.cn)("text-xl font-semibold leading-none tracking-tight",t),...a})}).displayName="CardTitle",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})}).displayName="CardDescription",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",t),...a})}).displayName="CardContent",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})}).displayName="CardFooter"},3759:function(e,s,t){"use strict";t.d(s,{$N:function(){return f},Be:function(){return p},Vq:function(){return i},cN:function(){return u},cZ:function(){return x},fK:function(){return m}});var r=t(7821),a=t(8078),n=t(9551),d=t(3116),l=t(7211);let i=n.fC;n.xz;let o=n.h_;n.x8;let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(n.aV,{ref:s,className:(0,l.cn)("fixed inset-0 z-50 bg-black/50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a})});c.displayName=n.aV.displayName;let x=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,r.jsxs)(o,{children:[(0,r.jsx)(c,{}),(0,r.jsxs)(n.VY,{ref:s,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i,children:[a,(0,r.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=n.VY.displayName;let m=e=>{let{className:s,...t}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};m.displayName="DialogHeader";let u=e=>{let{className:s,...t}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};u.displayName="DialogFooter";let f=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(n.Dx,{ref:s,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",t),...a})});f.displayName=n.Dx.displayName;let p=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(n.dk,{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",t),...a})});p.displayName=n.dk.displayName},3507:function(e,s,t){"use strict";t.d(s,{g:function(){return d}});var r=t(7821),a=t(8078),n=t(7211);let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...a})});d.displayName="Textarea"},7211:function(e,s,t){"use strict";t.d(s,{cn:function(){return n}});var r=t(2605),a=t(1638);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.m6)((0,r.W)(s))}},1996:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(6576).Z)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])}},function(e){e.O(0,[163,900,725,115,253,744],function(){return e(e.s=1088)}),_N_E=e.O()}]);