(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[939],{7752:function(e,s,r){Promise.resolve().then(r.bind(r,1423))},1423:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return I}});var t=r(7821),a=r(8078),l=r(8504),i=r(3923),d=r(3842),n=r(8006),c=r(5231),o=r(9367),m=r(9086),x=r(641),u=r(7296),h=r(687);let p=(0,r(6576).Z)("sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var f=r(4680),b=r(1475);let g={車況提醒:[{id:"lights",label:"車燈未開"},{id:"door",label:"車門未關"},{id:"trunk",label:"行李箱"},{id:"tire",label:"輪胎異常"},{id:"window",label:"車窗未關"},{id:"other-vehicle",label:"其他車況"}],行車安全提醒:[{id:"signal",label:"未打方向燈"},{id:"lane",label:"變換車道"},{id:"speed",label:"車速過快"},{id:"distance",label:"跟車太近"},{id:"pedestrian",label:"路口/行人"},{id:"other-safety",label:"其他安全"}],讚美感謝:[{id:"thank-yield",label:"謝謝讓路"},{id:"stable",label:"行車穩定"},{id:"pedestrian-yield",label:"禮讓行人"},{id:"distance-keep",label:"保持距離"},{id:"other-praise",label:"其他讚美"}]},v={lights:"提醒您車燈似乎尚未開啟，行駛時請多注意安全。",door:"提醒您車門可能未完全關閉，為了安全請多留意。",trunk:"提醒您行李箱似乎未完全關好，行駛時請多注意。",tire:"提醒您車輛輪胎狀況似乎有些異常，建議留意安全。",window:"提醒您車窗可能尚未關閉，行駛時請多注意。","other-vehicle":"提醒您車輛狀況可能需要留意，請多注意行車安全。",signal:"剛剛變換車道時似乎未打方向燈，提醒您注意行車安全。",lane:"剛剛變換車道時距離較近，提醒您多留意行車安全。",speed:"剛剛行駛速度似乎較快，提醒您注意行車安全。",distance:"剛剛與前車距離較近，提醒您保持安全車距。",pedestrian:"經過路口時情況較複雜，提醒您多留意行人安全。","other-safety":"剛剛的行車狀況可能較有風險，提醒您多注意安全。","thank-yield":"謝謝您剛剛的禮讓，讓行車更加順暢。",stable:"剛剛的行車方式很穩定，謝謝您保持良好習慣。","pedestrian-yield":"謝謝您禮讓行人，讓道路環境更加友善。","distance-keep":"謝謝您保持良好的車距，讓行車更安全。","other-praise":"謝謝您的駕駛方式，讓人感到安心。"},j={車況提醒:[{id:"lights",label:"大燈未開"},{id:"rear-cargo",label:"後座物品"},{id:"plate-blocked",label:"車牌遮擋"},{id:"tire",label:"輪胎異常"},{id:"exhaust",label:"排氣管異常"},{id:"other-vehicle",label:"其他車況"}],行車安全提醒:[{id:"helmet",label:"未戴安全帽"},{id:"signal",label:"未打方向燈"},{id:"lane",label:"變換車道"},{id:"unstable",label:"騎乘不穩"},{id:"pedestrian",label:"行人/路口"},{id:"other-safety",label:"其他安全"}],讚美感謝:[{id:"thank-yield",label:"謝謝讓路"},{id:"stable",label:"騎乘穩定"},{id:"pedestrian-yield",label:"禮讓行人"},{id:"distance-keep",label:"保持距離"},{id:"other-praise",label:"其他讚美"}]},N={lights:"提醒您大燈似乎尚未開啟，夜間騎乘請多注意安全。","rear-cargo":"提醒您後座物品可能未固定，騎乘時請多留意。","plate-blocked":"提醒您車牌可能被遮擋，騎乘時請多注意。",tire:"提醒您輪胎狀況似乎有些異常，建議留意安全。",exhaust:"提醒您排氣管狀況可能異常，騎乘時請多注意。","other-vehicle":"提醒您機車狀況可能需要留意，請多注意騎乘安全。",helmet:"提醒您騎乘時請記得配戴安全帽，注意行車安全。",signal:"剛剛變換車道時似乎未打方向燈，騎乘時請多注意。",lane:"剛剛變換車道時距離較近，提醒您注意騎乘安全。",unstable:"剛剛騎乘狀況似乎不太穩定，提醒您多留意安全。",pedestrian:"經過路口時情況較複雜，提醒您多注意行人安全。","other-safety":"剛剛的騎乘狀況可能較有風險，提醒您多注意安全。","thank-yield":"謝謝您剛剛的禮讓，讓道路更加順暢。",stable:"剛剛的騎乘方式很穩定，謝謝您保持良好習慣。","pedestrian-yield":"謝謝您禮讓行人，讓道路環境更加友善。","distance-keep":"謝謝您保持適當距離，讓騎乘更安全。","other-praise":"謝謝您的騎乘方式，讓人感到安心。"},y=(e,s)=>("car"===e?g:j)[s]||[],w=(e,s)=>("car"===e?v:N)[s]||"",k=(e,s)=>e.toUpperCase().replace(/[^A-Z0-9]/g,""),A=(e,s)=>{if(!e||e.length<3)return!1;let r=e.replace(/[^A-Z0-9]/g,"");return"car"===s?r.length>=4&&r.length<=7:r.length>=4&&r.length<=6},C=e=>"car"===e?"ABC-1234":"ABC-123 或 123-ABC";var Z=r(3295),S=r(1188);let z=a.memo(()=>{let e=(0,l.useRouter)(),{user:s,refreshUser:r,refreshMessages:g}=(0,i.q)(),[v,j]=(0,a.useState)("vehicle-type"),[N,z]=(0,a.useState)(null),[I,_]=(0,a.useState)(""),[M,L]=(0,a.useState)(""),[P,R]=(0,a.useState)(null),[q,E]=(0,a.useState)(""),[T,U]=(0,a.useState)(""),[B,D]=(0,a.useState)(""),[F,O]=(0,a.useState)(""),[X,$]=(0,a.useState)(!1),[H,W]=(0,a.useState)(!1),[G,J]=(0,a.useState)({canUse:!0,remaining:5}),[K,Q]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!s){e.push("/login");return}V()},[s,e]);let V=async()=>{try{let e=await Z.no.checkLimit();J(e)}catch(e){console.error("Failed to check AI limit:",e)}},Y=()=>"讚美感謝"===P?0:B?X&&H?5:B?4:1:1,ee=e=>{var r;return(null!==(r=null==s?void 0:s.points)&&void 0!==r?r:0)>=e},es=e=>{z(e),j("plate-input")},er=e=>{R(e),E(""),U(""),D(""),O(""),$(!1),j("situation")},et=e=>{N&&(E(e),U(w(N,e)),j("review"))},ea=async()=>{if(!B.trim()||"讚美感謝"===P){j("confirm");return}if(G.canUse&&B.trim()){Q(!0);try{let e=await Z.no.rewrite(B);O(e.rewritten),W(!0),await V(),j("ai-suggest")}catch(r){var e,s;f.Am.error((null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"AI 改寫失敗"),j("confirm")}finally{Q(!1)}}else j("confirm")},el=async()=>{if(!ee(Y())){f.Am.error("點數不足，請先儲值"),e.push("/wallet");return}if(!P||!I||!T){f.Am.error("請完成所有步驟");return}Q(!0);try{let s=(0,S.qX)(I);if(!s){f.Am.error("車牌號碼格式無效"),Q(!1);return}await Z.Mp.create({licensePlate:s,type:P,template:T,customText:B||void 0,useAiRewrite:H}),await r(),await g(),f.Am.success("提醒已發送"),j("success"),setTimeout(()=>{e.push("/home")},2e3)}catch(e){var s,t;f.Am.error((null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||"發送失敗")}finally{Q(!1)}};return s?"success"===v?(0,t.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:(0,t.jsxs)(n.Zb,{className:"p-8 text-center space-y-6",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-primary/10 rounded-full mx-auto flex items-center justify-center",children:(0,t.jsx)(m.Z,{className:"h-8 w-8 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl text-foreground mb-2",children:"提醒已發送"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"正在返回首頁..."})]})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-background pb-20",children:[(0,t.jsx)("div",{className:"bg-card border-b border-border",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto px-6 py-4 flex items-center justify-between relative",children:[(0,t.jsxs)("button",{onClick:()=>{"vehicle-type"===v?e.push("/home"):"plate-input"===v?j("vehicle-type"):"category"===v?j("plate-input"):"situation"===v?j("category"):"review"===v?j("situation"):"custom"===v?j("review"):"ai-suggest"===v?j("custom"):"confirm"===v&&(F?j("ai-suggest"):B?j("custom"):j("review"))},className:"flex items-center gap-2 p-1 hover:bg-muted/50 rounded transition-colors",children:[(0,t.jsx)(x.Z,{className:"h-5 w-5 text-muted-foreground",strokeWidth:2}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"返回"})]}),(0,t.jsx)("h1",{className:"text-base text-foreground absolute left-1/2 -translate-x-1/2",children:"發送提醒"}),(0,t.jsx)("div",{className:"w-[80px]"})]})}),(0,t.jsxs)("div",{className:"max-w-md mx-auto p-6 space-y-6",children:["vehicle-type"===v&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-medium mb-2",children:"選擇車種"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"選擇目標車輛的類型"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("button",{onClick:()=>es("car"),className:"w-full p-6 bg-card border-2 border-border hover:border-primary hover:bg-primary/5 rounded-2xl transition-all",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(u.Z,{className:"h-8 w-8 text-primary"}),(0,t.jsx)("div",{className:"flex-1 text-left",children:(0,t.jsx)("p",{className:"font-medium text-foreground",children:"汽車"})})]})}),(0,t.jsx)("button",{onClick:()=>es("scooter"),className:"w-full p-6 bg-card border-2 border-border hover:border-primary hover:bg-primary/5 rounded-2xl transition-all",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(h.Z,{className:"h-8 w-8 text-primary"}),(0,t.jsx)("div",{className:"flex-1 text-left",children:(0,t.jsx)("p",{className:"font-medium text-foreground",children:"機車"})})]})})]})]}),"plate-input"===v&&N&&(0,t.jsxs)(n.Zb,{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h2",{className:"text-xl text-foreground",children:"輸入車牌號碼"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"輸入目標車輛的車牌"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(o._,{htmlFor:"plate",children:"車牌號碼"}),(0,t.jsx)(c.I,{id:"plate",placeholder:C(N),value:M,onChange:e=>{L(k(e.target.value,N))},className:"text-center font-mono tracking-wider"})]}),(0,t.jsx)(d.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:()=>{if(!N)return;let e=(0,S.qX)(M);if(!e){f.Am.error("請輸入正確的車牌格式");return}_(e),j("category")},disabled:!A(M,N),children:"下一步"})]}),"category"===v&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("h2",{className:"text-xl font-medium mb-2",children:"選擇提醒類型"})}),(0,t.jsx)("div",{className:"space-y-3",children:["車況提醒","行車安全提醒","讚美感謝"].map(e=>(0,t.jsxs)("button",{onClick:()=>er(e),className:"w-full p-4 bg-card border-2 border-border hover:border-primary hover:bg-primary/5 rounded-xl transition-all text-left",children:[(0,t.jsx)("p",{className:"font-medium text-foreground",children:e}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"讚美感謝"===e?"免費，可獲得1點回饋":"消耗1點"})]},e))})]}),"situation"===v&&N&&P&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("h2",{className:"text-xl font-medium mb-2",children:"選擇情境"})}),(0,t.jsx)("div",{className:"space-y-2",children:y(N,P).map(e=>(0,t.jsx)("button",{onClick:()=>et(e.id),className:"w-full p-4 bg-card border border-border hover:border-primary hover:bg-primary/5 rounded-lg transition-all text-left",children:(0,t.jsx)("p",{className:"text-foreground",children:e.label})},e.id))})]}),"review"===v&&(0,t.jsxs)(n.Zb,{className:"p-6 space-y-6",children:[(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("h2",{className:"text-xl text-foreground",children:"預覽提醒"})}),(0,t.jsx)("div",{className:"p-4 bg-muted/30 rounded-lg",children:(0,t.jsx)("p",{className:"text-foreground",children:T})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(d.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:()=>j("custom"),children:"補充說明（可選）"}),(0,t.jsx)(d.z,{variant:"outline",className:"w-full",onClick:()=>j("confirm"),children:"直接發送"})]})]}),"custom"===v&&(0,t.jsxs)(n.Zb,{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h2",{className:"text-xl text-foreground",children:"補充說明（可選）"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"最多100字，補充文字會增加點數消耗"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(o._,{htmlFor:"customText",children:"補充說明"}),(0,t.jsx)("textarea",{id:"customText",className:"flex min-h-[100px] w-full rounded-lg border border-input bg-input px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"例如：在高速公路上特別重要",value:B,onChange:e=>D(e.target.value.slice(0,100)),maxLength:100}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-right",children:[B.length,"/100"]}),B&&(0,t.jsxs)("div",{className:"p-3 bg-primary/5 rounded-lg border border-primary/20",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"點數提示："}),(0,t.jsxs)("p",{className:"text-sm text-foreground",children:["補充文字 +3點",G.canUse&&"，使用AI改寫 +1點（共+4點）"]})]})]}),(0,t.jsx)(d.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:ea,disabled:K,children:K?"處理中...":"下一步"})]}),"ai-suggest"===v&&(0,t.jsxs)(n.Zb,{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h2",{className:"text-xl text-foreground",children:"AI 改寫建議"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"AI 已將您的文字改寫為更溫和的語氣"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"原本版本"}),(0,t.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg",children:[(0,t.jsx)("p",{className:"text-foreground",children:T}),B&&(0,t.jsx)("p",{className:"text-foreground mt-2",children:B})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[(0,t.jsx)(p,{className:"h-3 w-3 text-primary"}),"AI 建議版本"]}),(0,t.jsx)("div",{className:"p-4 bg-primary/5 rounded-lg border border-primary/20",children:(0,t.jsx)("p",{className:"text-foreground",children:F})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:()=>{$(!0),j("confirm")},children:"使用建議版本"}),(0,t.jsx)(d.z,{variant:"outline",className:"w-full",onClick:()=>{$(!1),j("confirm")},children:"照原本的"})]})]}),"confirm"===v&&(0,t.jsxs)(n.Zb,{className:"p-6 space-y-6",children:[(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("h2",{className:"text-xl text-foreground",children:"確認發送"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-muted/30 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"目標車牌"}),(0,t.jsx)("p",{className:"text-foreground font-mono",children:(0,S.uk)(I)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"提醒類型"}),(0,t.jsx)("p",{className:"text-foreground",children:P})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"提醒內容"}),(0,t.jsx)("p",{className:"text-foreground",children:X?F:T}),B&&!X&&(0,t.jsx)("p",{className:"text-foreground mt-2",children:B})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-primary/5 rounded-lg border border-primary/20",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-foreground",children:"總點數消耗"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-primary-dark",children:[Y()," 點"]})]}),!ee(Y())&&(0,t.jsx)("p",{className:"text-xs text-destructive mt-2",children:"點數不足，請先儲值"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.z,{className:"w-full bg-primary hover:bg-primary-dark text-white",onClick:el,disabled:!ee(Y())||K,children:K?"發送中...":"確認發送"}),(0,t.jsx)(d.z,{variant:"outline",className:"w-full",onClick:()=>e.push("/home"),children:"取消"})]})]})]}),(0,t.jsx)(b.Z,{})]}):null});z.displayName="SendPage";var I=z},5231:function(e,s,r){"use strict";r.d(s,{I:function(){return i}});var t=r(7821),a=r(8078),l=r(7211);let i=a.forwardRef((e,s)=>{let{className:r,type:a,...i}=e;return(0,t.jsx)("input",{type:a,className:(0,l.cn)("flex h-11 w-full rounded-lg border border-input bg-input px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...i})});i.displayName="Input"},9367:function(e,s,r){"use strict";r.d(s,{_:function(){return d}});var t=r(7821),a=r(8078),l=r(255),i=r(7211);let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(l.f,{ref:s,className:(0,i.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",r),...a})});d.displayName=l.f.displayName},641:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});let t=(0,r(6576).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},255:function(e,s,r){"use strict";r.d(s,{f:function(){return n}});var t=r(8078);r(457);var a=r(7035),l=r(7821),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let r=(0,a.Z8)(`Primitive.${s}`),i=t.forwardRef((e,t)=>{let{asChild:a,...i}=e,d=a?r:s;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(d,{...i,ref:t})});return i.displayName=`Primitive.${s}`,{...e,[s]:i}},{}),d=t.forwardRef((e,s)=>(0,l.jsx)(i.label,{...e,ref:s,onMouseDown:s=>{var r;s.target.closest("button, input, select, textarea")||(null===(r=e.onMouseDown)||void 0===r||r.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));d.displayName="Label";var n=d}},function(e){e.O(0,[163,900,447,115,253,744],function(){return e(e.s=7752)}),_N_E=e.O()}]);