(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4463:function(e,t,o){Promise.resolve().then(o.t.bind(o,6866,23)),Promise.resolve().then(o.bind(o,4500)),Promise.resolve().then(o.bind(o,4842)),Promise.resolve().then(o.t.bind(o,7754,23))},4500:function(e,t,o){"use strict";o.d(t,{Providers:function(){return s}});var a=o(7821),r=o(3923);function s(e){let{children:t}=e;return(0,a.jsx)(r.w,{children:t})}},4842:function(e,t,o){"use strict";o.d(t,{Toaster:function(){return s}});var a=o(7821),r=o(4680);let s=e=>{let{...t}=e;return(0,a.jsx)(r.x7,{theme:"light",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-card group-[.toaster]:text-card-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})}},3923:function(e,t,o){"use strict";o.d(t,{q:function(){return c},w:function(){return l}});var a=o(7821),r=o(8078),s=o(8504),n=o(4680),i=o(3295);let u=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[o,l]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[g,h]=(0,r.useState)([]),[p,m]=(0,r.useState)(!0),v=(0,s.useRouter)(),f=(0,r.useCallback)(async()=>{try{let e=await i.g8.getMe();l(e),localStorage.setItem("user",JSON.stringify(e))}catch(e){console.error("Failed to refresh user:",e),e instanceof Error&&e.message.includes("401")&&(localStorage.removeItem("token"),localStorage.removeItem("user"),l(null))}},[]),y=(0,r.useCallback)(async()=>{try{let e=await i.Mp.getAll();d(e)}catch(e){console.error("Failed to refresh messages:",e)}},[]),w=(0,r.useCallback)(async()=>{try{let e=await i.Wp.getHistory();h(e)}catch(e){console.error("Failed to refresh point history:",e)}},[]);(0,r.useEffect)(()=>{(async()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{let e=JSON.parse(t);l(e),await f(),await y(),await w()}catch(e){console.error("Failed to load user:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),l(null)}}m(!1)})()},[]);let k=async(e,t)=>{try{let o;o=t.startsWith("eyJ")?{access_token:t,user:await i.g8.getMe()}:await i.iJ.login(e,t),localStorage.setItem("token",o.access_token),localStorage.setItem("user",JSON.stringify(o.user)),l(o.user),await y(),await w(),n.Am.success("登入成功"),v.push(o.user.hasCompletedOnboarding?"/home":"/onboarding")}catch(e){var o,a;throw n.Am.error((null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)||"登入失敗"),e}},b=async e=>{try{let t=await i.g8.updateMe(e);l(t),localStorage.setItem("user",JSON.stringify(t)),n.Am.success("更新成功")}catch(e){var t,o;throw n.Am.error((null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||"更新失敗"),e}};return(0,a.jsx)(u.Provider,{value:{user:o,messages:c,pointHistory:g,isLoading:p,login:k,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),l(null),d([]),h([]),v.push("/landing"),n.Am.success("已登出")},updateUser:b,refreshUser:f,refreshMessages:y,refreshPointHistory:w},children:t})}function c(){let e=(0,r.useContext)(u);if(void 0===e)throw Error("useApp must be used within AppProvider");return e}},3295:function(e,t,o){"use strict";o.d(t,{no:function(){return u},iJ:function(){return r},S9:function(){return l},Mp:function(){return n},Wp:function(){return i},g8:function(){return s}});let a=o(9190).Z.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),a.interceptors.response.use(e=>e,e=>{var t,o,a,r,s,n,i,u,l,c,d,g,h;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(null===(a=e.config)||void 0===a?void 0:null===(o=a.url)||void 0===o?void 0:o.includes("/auth/verify-phone"))===!1&&(null===(s=e.config)||void 0===s?void 0:null===(r=s.url)||void 0===r?void 0:r.includes("/auth/check-phone"))===!1&&(null===(i=e.config)||void 0===i?void 0:null===(n=i.url)||void 0===n?void 0:n.includes("/auth/reset-verify-count"))===!1&&(null===(l=e.config)||void 0===l?void 0:null===(u=l.url)||void 0===u?void 0:u.includes("/auth/login"))===!1&&(null===(d=e.config)||void 0===d?void 0:null===(c=d.url)||void 0===c?void 0:c.includes("/auth/set-password"))===!1&&(null===(h=e.config)||void 0===h?void 0:null===(g=h.url)||void 0===g?void 0:g.includes("/auth/reset-password"))===!1&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let r={checkPhone:e=>a.get("/auth/check-phone/".concat(e)).then(e=>e.data),verifyPhone:e=>a.post("/auth/verify-phone",{phone:e}).then(e=>e.data),login:(e,t)=>a.post("/auth/login",{phone:e,code:t}).then(e=>e.data),passwordLogin:(e,t)=>a.post("/auth/password-login",{phone:e,password:t}).then(e=>e.data),setPassword:(e,t,o)=>a.post("/auth/set-password",{phone:e,code:t,password:o}).then(e=>e.data),resetPassword:(e,t,o)=>a.post("/auth/reset-password",{phone:e,code:t,newPassword:o}).then(e=>e.data),resetVerifyCount:e=>a.post("/auth/reset-verify-count",{phone:e}).then(e=>e.data)},s={getMe:()=>a.get("/users/me").then(e=>e.data),updateMe:e=>a.put("/users/me",e).then(e=>e.data),completeOnboarding:e=>a.put("/users/me/onboarding",e).then(e=>e.data),findByLicensePlate:e=>a.get("/users/license-plate/".concat(e)).then(e=>e.data),blockUser:e=>a.post("/users/block",{userId:e}).then(e=>e.data),unblockUser:e=>a.delete("/users/block/".concat(e)).then(e=>e.data),rejectUser:e=>a.post("/users/reject",{userId:e}).then(e=>e.data),unrejectUser:e=>a.delete("/users/reject/".concat(e)).then(e=>e.data),getBlockedList:()=>a.get("/users/blocked").then(e=>e.data),getRejectedList:()=>a.get("/users/rejected").then(e=>e.data)},n={create:e=>a.post("/messages",e).then(e=>e.data),getAll:e=>a.get("/messages",{params:{unreadOnly:e}}).then(e=>e.data),getSent:()=>a.get("/messages/sent").then(e=>e.data),getOne:e=>a.get("/messages/".concat(e)).then(e=>e.data),markAsRead:e=>a.post("/messages/".concat(e,"/read")).then(e=>e.data),reply:(e,t)=>a.post("/messages/".concat(e,"/reply"),{replyText:t}).then(e=>e.data),report:(e,t)=>a.post("/messages/".concat(e,"/report"),{reason:t}).then(e=>e.data)},i={getBalance:()=>a.get("/points/balance").then(e=>e.data),getHistory:()=>a.get("/points/history").then(e=>e.data),recharge:e=>a.post("/points/recharge",{amount:e}).then(e=>e.data)},u={checkLimit:()=>a.get("/ai/rewrite/limit").then(e=>e.data),rewrite:e=>a.post("/ai/rewrite",{text:e}).then(e=>e.data)},l={checkAvailability:e=>a.get("/users/check-license-plate/".concat(e)).then(e=>e.data),createApplication:e=>a.post("/users/license-plate-application",e).then(e=>e.data),getMyApplications:()=>a.get("/users/license-plate-application").then(e=>e.data),getApplication:e=>a.get("/users/license-plate-application/".concat(e)).then(e=>e.data)}},8504:function(e,t,o){"use strict";var a=o(3226);o.o(a,"usePathname")&&o.d(t,{usePathname:function(){return a.usePathname}}),o.o(a,"useRouter")&&o.d(t,{useRouter:function(){return a.useRouter}})},6866:function(){},7754:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[884,900,115,253,744],function(){return e(e.s=4463)}),_N_E=e.O()}]);