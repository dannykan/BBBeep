# API 調試指南

## 常見錯誤：400 Bad Request

### 問題：POST /messages 返回 400

**可能原因：**

1. **驗證失敗** - DTO 驗證不通過
2. **類型轉換問題** - 中英文 enum 轉換失敗
3. **缺少必填字段** - 請求體缺少必要字段

### 調試步驟

#### 1. 檢查後端日誌

查看後端終端的錯誤信息，應該會顯示具體的驗證錯誤。

#### 2. 檢查請求數據

在瀏覽器開發者工具的 Network 標籤中，查看：
- Request Payload（請求體）
- 確認所有必填字段都存在
- 確認類型值為：`'車況提醒'`、`'行車安全提醒'` 或 `'讚美感謝'`

#### 3. 檢查後端驗證

後端期望的請求格式：

```json
{
  "licensePlate": "ABC-1234",
  "type": "車況提醒",  // 必須是這三個值之一
  "template": "提醒您車燈似乎尚未開啟",
  "customText": "補充說明（可選）",
  "useAiRewrite": false
}
```

#### 4. 測試 API

使用 Swagger 文檔測試：
- 訪問 http://localhost:3001/api
- 找到 `POST /messages` 端點
- 使用 Swagger UI 測試發送請求

### 常見問題解決

#### 問題 1：type 字段驗證失敗

**解決方案**：確保發送的 `type` 值為：
- `'車況提醒'`
- `'行車安全提醒'`
- `'讚美感謝'`

#### 問題 2：licensePlate 格式錯誤

**解決方案**：確保車牌格式正確，已自動轉換為大寫。

#### 問題 3：缺少 template 字段

**解決方案**：確保發送請求時包含 `template` 字段。

### 檢查後端日誌

後端應該會輸出詳細的驗證錯誤信息，例如：

```
[Nest] Validation failed:
- property type should be one of the following values: 車況提醒, 行車安全提醒, 讚美感謝
```

### 快速修復

如果問題持續，可以：

1. **重啟後端服務器**
2. **檢查環境變數**是否正確
3. **查看完整錯誤堆棧**在後端終端
